const Zs=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};Zs();const re=(t,e,n)=>{const s=window.devicePixelRatio||1;return s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s},Ke=()=>(window.devicePixelRatio||1)>1;function Ys(t,e,n,s){var r=arguments.length,o=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}const Ks=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),r=Symbol("isa");function o(i){for(let a of n){const c=Object.getOwnPropertyDescriptor(i.prototype,a);(!c||c.configurable)&&Object.defineProperty(i.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(i.prototype,r,{value:!0}),i}for(let i of s)Object.defineProperty(o,i,{value:e[i],enumerable:e.propertyIsEnumerable(i)});return Object.defineProperty(o,Symbol.hasInstance,{value:i=>!!i[r]}),o},Qs=Ks({addWatch(t,e){return this._watches=this._watches||{},this._watches[t]?!1:(this._watches[t]=e,!0)},removeWatch(t){if(!!this._watches)return this._watches[t]?(delete this._watches[t],!0):!1},notifyWatches(t,e){if(!this._watches)return;const n=this._watches;for(let s in n)n[s](s,t,e)}}),ut=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{constructor(n){super(t(n)+e(n))}},tr=ut(()=>"illegal state"),jn=t=>{throw new tr(t)},at=Array.isArray,er=t=>t&&(t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint8ClampedArray),Y=t=>typeof t=="string",nr=ut(()=>"Assertion failed"),me=(()=>typeof process<"u"&&typeof process.env<"u"?!!{}.UMBRELLA_ASSERTS:typeof __SNOWPACK_ENV__<"u"?__SNOWPACK_ENV__.MODE!=="production"||!!__SNOWPACK_ENV__.UMBRELLA_ASSERTS||!!__SNOWPACK_ENV__.SNOWPACK_PUBLIC_UMBRELLA_ASSERTS:!0)()?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new nr(typeof e=="function"?e():e)}:()=>{},Vn=t=>at(t)?t:Y(t)?t.length>0?t.split("."):[]:t!=null?[t]:[];function Hn(t){const e=Vn(t),[n,s,r,o]=e;switch(e.length){case 0:return(a,c)=>c;case 1:return(a,c)=>(a=k(a),a[n]=c,a);case 2:return(a,c)=>{let l;return a=k(a),a[n]=l=k(a[n]),l[s]=c,a};case 3:return(a,c)=>{let l,u;return a=k(a),a[n]=l=k(a[n]),l[s]=u=k(l[s]),u[r]=c,a};case 4:return(a,c)=>{let l,u,p;return a=k(a),a[n]=l=k(a[n]),l[s]=u=k(l[s]),u[r]=p=k(u[r]),p[o]=c,a};default:let i;for(let a=e.length;a-- >0;)i=sr(e[a],i);return i}}const k=t=>at(t)||er(t)?t.slice():{...t},sr=(t,e)=>(n,s)=>(n=k(n),n[t]=e?e(n[t],s):s,n),Qe=(t,e,n)=>Hn(e)(t,n);function rr(t){const e=Vn(t),[n,s,r,o]=e;switch(e.length){case 0:return i=>i;case 1:return i=>i?.[n];case 2:return i=>i!=null&&(i=i[n])!=null?i[s]:void 0;case 3:return i=>i!=null&&(i=i[n])!=null&&(i=i[s])!=null?i[r]:void 0;case 4:return i=>i!=null&&(i=i[n])!=null&&(i=i[s])!=null&&(i=i[r])!=null?i[o]:void 0;default:return i=>{const a=e.length-1;let c=i;for(let l=0;c!=null&&l<=a;l++)c=c[e[l]];return c}}}const tn=(t,e,n,...s)=>or(t,e,n,...s);function or(t,e,n,...s){return Hn(e)(t,n.apply(null,(s.unshift(rr(e)(t)),s)))}let oe=class{constructor(e,n){n&&!n(e)&&jn("initial state value did not validate"),this._value=e,this.valid=n}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const n=this._value;return this.valid&&!this.valid(e)?n:(this._value=e,this.notifyWatches(n,e),e)}resetIn(e,n){return this.reset(Qe(this._value,e,n))}resetInUnsafe(e,n){return this.reset(Qe(this._value,e,n))}swap(e,...n){return this.reset(e.apply(null,[this._value,...n]))}swapIn(e,n,...s){return this.reset(tn(this._value,e,n,...s))}swapInUnsafe(e,n,...s){return this.reset(tn(this._value,e,n,...s))}addWatch(e,n){}removeWatch(e){}notifyWatches(e,n){}release(){return delete this._watches,delete this._value,!0}};oe=Ys([Qs],oe);const z=Symbol(),D=()=>{},_e=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",en=Object.getPrototypeOf({}),mt="function",nn="string",K=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===mt)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===mt)return e.equiv(t)}else return t==e;return typeof t===nn||typeof e===nn?!1:(n=Object.getPrototypeOf(t),(n==null||n===en)&&(n=Object.getPrototypeOf(e),n==null||n===en)?xn(t,e):typeof t!==mt&&t.length!==void 0&&typeof e!==mt&&e.length!==void 0?Un(t,e):t instanceof Set&&e instanceof Set?zn(t,e):t instanceof Map&&e instanceof Map?Bn(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Un=(t,e,n=K)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},zn=(t,e,n=K)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Bn=(t,e,n=K)=>t.size===e.size&&n([...t].sort(),[...e].sort()),xn=(t,e,n=K)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0};let _t,bt,ir=[],ar=[];const cr=t=>_t&&_t.length>=t?_t:_t=new Int32Array(t),lr=t=>bt&&bt.length>=t?bt:bt=new Int32Array(t),sn=(t,e,n,s,r)=>{const o=e.length,i=t.linear;if(t.distance=o,r!=="only-distance"){for(let a=0,c=0;a<o;a++,c+=3)i[c]=s,i[c+1]=a,i[c+2]=e[a];if(r==="full"){const a=t[n];for(let c=0;c<o;c++)a[c]=e[c]}}return t},Gn=(t,e,n="full",s=K)=>{const r={distance:0,adds:{},dels:{},const:{},linear:[]};if(t===e||t==null&&e==null)return r;if(t==null||t.length===0)return sn(r,e,"adds",1,n);if(e==null||e.length===0)return sn(r,t,"dels",-1,n);const o=t.length>=e.length;let i,a,c,l;o?(i=e,a=t):(i=t,a=e),c=i.length,l=a.length;const u=c+1,p=l-c,f=p+u,d=c+l+3,h=lr(d).fill(-1,0,d),m=cr(d).fill(-1,0,d),b=ir,_=ar,y=(S,E,$)=>{let C,v;E>$?(C=h[S-1],v=E):(C=h[S+1],v=$);let W=v-(S-u);for(;W<c&&v<l&&s(i[W],a[v]);)W++,v++;h[S]=_.length/3,_.push(W,v,C),m[S]=v};let g=-1,w;do{for(g++,w=-g+u;w<f;w++)y(w,m[w-1]+1,m[w+1]);for(w=f+g;w>f;w--)y(w,m[w-1]+1,m[w+1]);y(f,m[f-1]+1,m[f+1])}while(m[f]!==l);if(r.distance=p+2*g,n!=="only-distance"){for(g=h[f]*3;g>=0;)b.push(g),g=_[g+2]*3;n==="full"?ur(b,_,r,i,a,o):hr(b,_,r,i,a,o,n==="only-distance-linear")}return b.length=0,_.length=0,r},ur=(t,e,n,s,r,o)=>{const i=n.linear,a=n.const;let c=t.length,l=0,u=0,p,f,d,h;for(o?(p=n.dels,f=n.adds,d=-1,h=1):(p=n.adds,f=n.dels,d=1,h=-1);c-- >0;){const m=t[c],b=e[m],_=e[m+1],y=_-b;for(;l<b||u<_;){const g=u-l;y>g?(i.push(d,u,p[u]=r[u]),u++):y<g?(i.push(h,l,f[l]=s[l]),l++):(i.push(0,l,a[l]=s[l]),l++,u++)}}},hr=(t,e,n,s,r,o,i)=>{const a=n.linear,c=o?-1:1,l=o?1:-1;let u=t.length,p=0,f=0;for(;u-- >0;){const d=t[u],h=e[d],m=e[d+1],b=m-h;for(;p<h||f<m;){const _=f-p;b>_?(a.push(c,f,r[f]),f++):b<_?(a.push(l,p,s[p]),p++):(i&&a.push(0,p,s[p]),p++,f++)}}},fr=(t,e,n="full",s=K)=>t===e?{distance:0}:n==="only-distance"?dr(t,e,s):pr(t,e,s),dr=(t,e,n)=>{t||(t={}),e||(e={});let s=0;for(let r in t){const o=e[r];(o===void 0||!n(t[r],o))&&s++}for(let r in e)!(r in t)&&s++;return{distance:s}},pr=(t,e,n)=>{t||(t={}),e||(e={});let s=0;const r=[],o=[],i=[];for(let a in t){const c=e[a];c===void 0?(o.push(a),s++):n(t[a],c)||(i.push(a,c),s++)}for(let a in e)a in t||(r.push(a),s++);return{distance:s,adds:r,dels:o,edits:i}},Lt=Array.isArray,mr=Math.max,rn=Object.getPrototypeOf({}),gt="function",Mt="string",on=(()=>{const t=new Array(2048);for(let e=2,n=t.length;e<n;e++)t[e]=e-2;return t})(),_r=t=>{if(t<=on.length)return on.slice(0,t);const e=new Array(t);for(;t-- >2;)e[t]=t-2;return e},Wn=(t,e,n,s,r,o=0)=>{const i=r[1];if(i.__skip)return;if(i.__diff===!1){st(s),e.replaceChild(t,n,o,r);return}const a=s[1];if(a&&a.__skip){e.replaceChild(t,n,o,r,!1);return}let c=i.__impl;if(c&&c!==e)return c.diffTree(t,c,n,s,r,o);const l=Gn(s,r,"only-distance-linear",et);if(l.distance===0)return;const u=l.linear,p=e.getChild(n,o);let f,d,h;if(u[0]!==0||s[1].key!==i.key){st(s),e.replaceChild(t,n,o,r);return}if((h=s.__release)&&h!==r.__release&&st(s),u[3]!==0&&(Ir(e,p,s[1],r[1]),l.distance===2))return;const m=u.length,b=s.length-1,_=Sr(u),y=_r(b+1);for(f=6;f<m;f+=3)d=u[f],d&&(d===-1?br(t,e,p,s,r,u,f,_,y,b):gr(t,e,p,u,f,_,y,b));(h=r.__init)&&h!=s.__init&&h.apply(r,[p,...r.__args])},br=(t,e,n,s,r,o,i,a,c,l)=>{const u=o[i+2];if(Lt(u)){let p=u[1].key;if(p!==void 0&&a[p][2]!==void 0){const f=a[p];p=f[0],Wn(t,e,n,s[p],r[f[2]],c[p])}else{const f=o[i+1];st(u),e.removeChild(n,c[f]),yr(c,l,f)}}else typeof u===Mt&&e.setContent(n,"")},gr=(t,e,n,s,r,o,i,a)=>{const c=s[r+2];if(typeof c===Mt)e.setContent(n,c);else if(Lt(c)){const l=c[1].key;if(l===void 0||o[l][0]===void 0){const u=s[r+1];e.createTree(t,n,c,i[u]),wr(i,a,u)}}},yr=(t,e,n)=>{for(;e>n;e--)t[e]=mr(t[e]-1,0)},wr=(t,e,n)=>{for(;e>=n;e--)t[e]++},Ir=(t,e,n,s)=>{const r=fr(n,s,"full",K);t.removeAttribs(e,r.dels,n);let o=z,i,a,c;for(c=r.edits,i=c.length;(i-=2)>=0;)a=c[i],a[0]==="o"&&a[1]==="n"&&t.removeAttribs(e,[a],n),a!=="value"?t.setAttrib(e,a,c[i+1],s):o=c[i+1];for(c=r.adds,i=c.length;i-- >0;)a=c[i],a!=="value"?t.setAttrib(e,a,s[a],s):o=s[a];o!==z&&t.setAttrib(e,"value",o,s)},st=t=>{if(Lt(t)){let e;if((e=t[1])&&e.__release===!1)return;for(t.__release&&(t.__release.apply(t.__this,t.__args),delete t.__release),e=t.length;e-- >2;)st(t[e])}},Sr=t=>{let e,n,s;const r={};for(let o=t.length;(o-=3)>=0;)n=t[o+2],Lt(n)&&(e=n[1].key)!==void 0&&(s=r[e],!s&&(r[e]=s=[,,]),s[t[o]+1]=t[o+1]);return r},et=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===gt)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===gt)return e.equiv(t)}else return t==e;return typeof t===Mt||typeof e===Mt?!1:(n=Object.getPrototypeOf(t),(n==null||n===rn)&&(n=Object.getPrototypeOf(e),n==null||n===rn)?!(t.__diff===!1||e.__diff===!1)&&xn(t,e,et):typeof t!==gt&&t.length!==void 0&&typeof e!==gt&&e.length!==void 0?Un(t,e,et):t instanceof Set&&e instanceof Set?zn(t,e,et):t instanceof Map&&e instanceof Map?Bn(t,e,et):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},V=(t,e)=>t!=null&&typeof t[e]=="function",Ft=Math.PI,P=Ft*2,ie=Ft/2;let H=1e-6;const jt=(t,e)=>{let n;(n=e.fill)&&n!=="none"&&t.fill(),(n=e.stroke)&&n!=="none"&&t.stroke(),(n=e.clip)&&t.clip(n===!0?"nonzero":n)},an=(t,e,n,s,r=0,o=P,i=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,r,o,i),jt(t,e)},Er=(t,e,n,s,r=0,o=0,i=P,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],r,o,i,a),jt(t,e)},be=t=>typeof t=="number",Ar=ut(()=>"unsupported operation"),ge=t=>{throw new Ar(t)},Jt={},vr=(t,e,n,s)=>{const r=Jt[n];me(!!r,`no conversions available for ${n}`);let o=r[s];return o?o(t,e):Jt.rgb[s]?r.rgb(t,Jt.rgb[s]([],e)):ge(`can't convert: ${s} -> ${n}`)},ae=(t,e,n)=>t<e?e:t>n?n:t,Mr=t=>t>0?t:0,N=t=>t<0?0:t>1?1:t,qn=t=>t-Math.floor(t),Or=(t,e=1)=>Math.round(t/e)*e;function ht(t,e){return!e&&(e={}),(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}const Xn=ht((t,e)=>t.repeat(e)),Vt=ht((t,e=" ")=>{const n=Xn(String(e),t);return(s,r)=>s==null?n:(s=s.toString(),r=r!==void 0?r:s.length,r<t?n.substring(r)+s:s)});Vt(2,"0");Vt(3,"0");Vt(4,"0");const ye=ht((t,e=!1)=>e?n=>Jn(n)||n.toFixed(t):n=>n.toFixed(t));ht((t,e=3)=>{const n=t-e-1,s=Math.pow(10,n),r=-Math.pow(10,n-1),o=Math.pow(10,-(e-1)),i=Vt(t);return a=>{const c=Math.abs(a);return i(Jn(a)||(a===0?"0":c<o||c>=s?Dr(a,t):a.toFixed(e-(a<r?1:0))))}});const Dr=(t,e)=>t.toExponential(Math.max(e-4-(Math.log(Math.abs(t))/Math.LN10>=10?2:1)-(t<0?1:0),0)),Jn=t=>isNaN(t)?"NaN":t===1/0?"+\u221E":t===-1/0?"-\u221E":void 0,Tr=(t=0)=>e=>(e*100).toFixed(t)+"%";Object.freeze([0,0,0,1]);Object.freeze([1,1,1,1]);Object.freeze([1,0,0,1]);Object.freeze([0,1,0,1]);Object.freeze([0,0,1,1]);Object.freeze([0,1,1,1]);Object.freeze([1,0,1,1]);Object.freeze([1,1,0,1]);const kr=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],Pr=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],Cr=[.96422,1,.82521],Rr=[.95047,1,1.08883];let Ot=ye(3),cn=Tr(3);const Nr=1/255,Q=(t,e=1)=>t!=null?N(t):e,Zn=t=>{const e=Ot(qn(t[0])*360),n=cn(N(t[1])),s=cn(N(t[2])),r=Q(t[3]);return r<1?`hsla(${e},${n},${s},${Ot(r)})`:`hsl(${e},${n},${s})`},$r=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),J=(t,e,n,s,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t),Lr=(t,e,n=1)=>J(t||e,qn(e[0]),N(e[1]),N(e[2]),Q(e[3],n)),Fr=(t,e)=>{t=Lr(t||e,e);const n=t[1],s=t[2],r=(2-n)*s/2;return t[2]=r,t[1]=r&&r<1?n*s/(r<.5?r*2:2-r*2):n,t},jr=t=>Zn(Fr([],t)),ln="0123456789abcdef",ce=t=>ln[t>>>4&15]+ln[t&15],Vr=t=>ce(t>>>8)+ce(t&255),Hr=t=>ce(t>>>16)+Vr(t);const we=ht((t,e,n="")=>{const s=Xn("0",e);return r=>(r=(r>>>0).toString(t),n+(r.length<e?s.substring(r.length)+r:r))});we(2,8);we(2,16);we(2,32);const Yn=Hr,le=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${Ot(e*Nr)})`:`#${Yn(t&16777215)}`},Ur=t=>(t&255)<<16|t>>16&255|t&4278255360,zr=Ur,Br=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],xr=t=>(t%=P,t<0?P+t:t),Gr=(t,e)=>xr(Math.atan2(t,e)),Wr=(t,e)=>{let{1:n,2:s}=e;s*=P;const r=Q(e[3]);return n>0?J(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,r):J(t||e,e[0],0,0,r)},Zt=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},Kn=(t,e,n=Cr)=>{const s=(e[0]+.16)/1.16;return J(t||e,Zt(e[1]/5+s)*n[0],Zt(s)*n[1],Zt(s-e[2]/2)*n[2],Q(e[3]))},qr=(t,e)=>Kn(t,e,Rr),Xr=ut(()=>"illegal arity"),Ie=t=>{throw new Xr(t)};function Qn(...t){let[e,n,s,r,o,i,a,c,l,u]=t;switch(t.length){case 0:Ie(0);case 1:return e;case 2:return(...f)=>e(n(...f));case 3:return(...f)=>e(n(s(...f)));case 4:return(...f)=>e(n(s(r(...f))));case 5:return(...f)=>e(n(s(r(o(...f)))));case 6:return(...f)=>e(n(s(r(o(i(...f))))));case 7:return(...f)=>e(n(s(r(o(i(a(...f)))))));case 8:return(...f)=>e(n(s(r(o(i(a(c(...f))))))));case 9:return(...f)=>e(n(s(r(o(i(a(c(l(...f)))))))));case 10:default:const p=(...f)=>e(n(s(r(o(i(a(c(l(u(...f))))))))));return t.length===10?p:Qn(p,...t.slice(10))}}const Ht=t=>V(t,"xform")?t.xform():t;function ts(...t){return t=t.map(Ht),Qn.apply(null,t)}const Se=t=>t!=null&&typeof t[Symbol.iterator]=="function",Ee=(t,e)=>[t[0],t[1],e],es=t=>t!=null&&typeof t!="function"&&t.length!==void 0;class ct{constructor(e){this.value=e}deref(){return this.value}}const Jr=t=>new ct(t),B=t=>t instanceof ct,ns=t=>t instanceof ct?t:new ct(t),rt=t=>t instanceof ct?t.deref():t,Zr=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Ie(t.length);function Yr(...t){const e=t[0],n=e[0],s=e[1],r=e[2];t=Zr(t);const o=t[0]==null?n():t[0],i=t[1];return rt(s(V(i,"$reduce")?i.$reduce(r,o):es(i)?Kr(r,o,i):Qr(r,o,i)))}const Kr=(t,e,n)=>{for(let s=0,r=n.length;s<r;s++)if(e=t(e,n[s]),B(e)){e=e.deref();break}return e},Qr=(t,e,n)=>{for(let s of n)if(e=t(e,s),B(e)){e=e.deref();break}return e},ss=(t,e)=>[t,n=>n,e];function rs(t){return t?[...t]:ss(()=>[],(e,n)=>(e.push(n),e))}function*os(t,e){const n=Ht(t)(rs()),s=n[1],r=n[2];for(let o of e){const i=r([],o);if(B(i)){yield*rt(s(i.deref()));return}i.length&&(yield*i)}yield*rt(s([]))}function*is(t,e){const n=Ht(t)([D,D,(s,r)=>r])[2];for(let s of e){let r=n(z,s);if(B(r)){r=rt(r.deref()),r!==z&&(yield r);return}r!==z&&(yield r)}}const as=(t,e,n=is)=>{const s=e.length-1;return Se(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function x(t,e){return Se(e)?is(x(t),e):n=>{const s=n[2];return Ee(n,(r,o)=>s(r,t(o)))}}function cs(...t){return as(cs,t)||(e=>{const n=e[2],s=t[0];let r=t[1]||0;return Ee(e,(o,i)=>n(o,s(r++,i)))})}function ls(t,e,n){return new to(t,e,n)}class to{constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let r=this.from,o=this.to;r<o&&!B(n);r+=s)n=e(n,r);else for(let r=this.from,o=this.to;r>o&&!B(n);r+=s)n=e(n,r);return n}}function eo(t,e){t=t||"";let n=!0;return e?[...e].join(t):ss(()=>"",(s,r)=>(s=n?s+r:s+t+r,n=!1,s))}function us(t,e){return Se(e)?os(us(t),e):n=>{const s=n[2];let r=t;return Ee(n,(o,i)=>--r>0?s(o,i):r===0?ns(s(o,i)):Jr(o))}}function hs(...t){return no(hs,Yr,t)}const no=(t,e,n)=>{let s,r;switch(n.length){case 4:r=n[3],s=n[2];break;case 3:r=n[2];break;case 2:return x(o=>t(n[0],n[1],o));default:Ie(n.length)}return e(Ht(n[0])(n[1]),s,r)};function*so(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let r=s.next();if(r.done)return;n.push(r.value)}yield n}}const G=(t=0)=>{const e=new Array(5);let n;const s=(...r)=>{const o=e[r[t].length]||n;return o?o(...r):ge(`no impl for vec size ${r[t].length}`)};return s.add=(r,o)=>e[r]=o,s.default=r=>n=r,s.impl=r=>e[r]||n,s},ro="o,a,b",oo="o,a,b,n",io="io=0,ia=0,so=1,sa=1",ao="!o&&(o=[]);",co=t=>([e,n,s])=>`${e}=${n}${t}${s};`,fs=([t,e])=>`${t}*${e}`,lo=([t,e])=>`s+=${t}*${e};`,uo=([t,e])=>`${t}=${e};`,ho=([t,e,n])=>`${t}=${e}+(${n}-${e})*n;`,fo=t=>e=>e>1?`${t}[i${t}+${e}*s${t}]`:e==1?`${t}[i${t}+s${t}]`:`${t}[i${t}]`,po=t=>x(fo(t),ls()),mo=t=>x(e=>`${t}[${e}]`,ls()),ds=(t,e,n,s="a",r="",o="",i="",a=!1)=>[o,hs(ts(us(t),cs((c,l)=>e(l,c))),eo(r),so.apply(null,n.split(",").map(a?po:mo))),i,s!==""?`return ${s};`:""],_o=(t,e,n="a",s,r,o=!1)=>[s,"for(let i=a.length;--i>=0;) {",t(e.split(",").map(o?i=>`${i}[i${i}+i*s${i}]`:i=>`${i}[i]`)),"}",r,n!==null?`return ${n};`:""],bo=(t,e)=>`!${t} && (${t}=${e.split(",")[1]});`,ft=(t,e,n,s=n,r="a",o,i,a,c=!1)=>new Function(n,ds(t,e,s,r,o,i,a,c).join("")),go=(t,e,n,s,r,o=r,i="a",a="",c,l,u=!1)=>new Function(s,`return (${r})=>{${ds(t,n,o,i,a,c,l,u).join("")}}`)(...e),Ut=(t,e,n=e,s="a",r,o,i=!1)=>new Function(e,_o(t,n,s,r,o,i).join("")),Ae=(t,e=ro,n,s="o",r=1,o)=>{n=n||e,o=o??bo(s,e);const i=G(r),a=c=>i.add(c,ft(c,t,e,n,s,"",o));return i.default(Ut(t,e,n,s,o)),[i,a(2),a(3),a(4)]},ps=t=>Ae(co(t)),ve=t=>ft(t,fs,`o,a,${io}`,"o,a","","+","return ",";",!0);ve(2);const Yt=ve(3);ve(4);const yo=(t,e,n,s=!1)=>{const r=Yt(e,n,0,0,3),o=Yt(e,n,1,0,3),i=Yt(e,n,2,0,3),a=Q(n[3]);return s?J(t||n,N(r),N(o),N(i),a):J(t||n,r,o,i,a)},ms=(t,e,n=kr)=>yo(t,n,e),wo=(t,e)=>ms(t,e,Pr),un=(t,e)=>ms(null,Kn(t,e)),Io=(t,e)=>wo(null,qr(t,e)),Kt=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,It=(t,e)=>J(t||e,Kt(e[0]),Kt(e[1]),Kt(e[2]),Q(e[3])),Qt=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,nt=t=>{const e=Qt(t[0]),n=Qt(t[1]),s=Qt(t[2]),r=Q(t[3]);return r<1?`rgba(${e},${n},${s},${Ot(r)})`:`#${Yn(e<<16|n<<8|s)}`},So=t=>nt(It([],t)),hn={abgr32:t=>le(zr(t[0])),argb32:t=>le(t[0]),hsl:Zn,hsv:jr,lab50:t=>nt(It(null,un([],t))),lab65:t=>nt(It(null,Io([],t))),lch:t=>nt(It(null,un(null,Wr([],t)))),rgb:So,srgb:nt},Eo=t=>{let e;return Y(t)?t:be(t)?le(t):t.mode?(e=hn[t.mode])?e(t):hn.rgb(vr([],t,"rgb",t.mode)):nt(t)},Me=Eo,Ao=(t,e)=>Y(e)?e[0]==="$"?t.grads[e.substring(1)]:e:Me(e),vo=(t,{from:e,to:n},s)=>{const r=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let o of s)r.addColorStop(o[0],Me(o[1]));return r},Mo=(t,{from:e,to:n,r1:s,r2:r},o)=>{const i=t.createRadialGradient(e[0],e[1],s,n[0],n[1],r);for(let a of o)i.addColorStop(a[0],Me(a[1]));return i},Oo=(t,e,{width:n,height:s},r,o,i,a)=>{if(V(r,"toImageData")&&(r=r.toImageData()),r instanceof ImageData){t.putImageData(r,o[0],o[1]);return}n=n||r.width,s=s||r.height,i?t.drawImage(r,i[0],i[1],a?a[0]:n,a?a[1]:s,o[0],o[1],n,s):t.drawImage(r,o[0],o[1],n,s)},Do={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},_s={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},fn=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),To=(t,e,n)=>{let s;if(!!n){Po(t,n)&&(s=fn(e,!0));for(let r in n){const o=_s[r];if(o){const i=n[r];i!=null&&e.attribs[r]!==i&&(!s&&(s=fn(e)),s.attribs[r]=i,s.edits.push(r),bs(t,e,r,o,i))}}return s}},ko=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let o=s.length;o-- >0;){const i=s[o],a=r[i];bs(t,e,i,_s[i],a??Do[i])}},dn=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},bs=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=Ao(e,r);break;case"dash":t[s].call(t,r);break;case"clip":break;default:t[s]=r}},Po=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(es(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},te=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},Co=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:r}of n)t.moveTo(s[0],s[1]),t.lineTo(r[0],r[1]);t.stroke()}},Ro=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&pn(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&pn(t,n,s,"stroke","strokeRect")},pn=(t,e,n,s,r)=>{const{start:o,cstride:i,estride:a,size:c}={start:0,cstride:1,estride:2,size:1,...e};let l=e&&e.num!=null?e.num:(n.length-o)/a|0;if(e.shape==="circle")for(let u=o;l-- >0;u+=a)t.beginPath(),t.arc(n[u],n[u+i],c,0,P),t[s]();else{const u=c/2;for(let p=o;l-- >0;p+=a)t[r](n[p]-u,n[p+i]-u,c,c)}},gs=(t,e,n)=>{t.beginPath();let s=[0,0];for(let r=0,o=n.length;r<o;r++){const i=n[r];let a=i[1],c,l;switch(i[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=i[2],l=i[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=i[2],l=i[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=i[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=i[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"a":c=i[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],i[3]),s=c;break;case"A":c=i[2],t.arcTo(a[0],a[1],c[0],c[1],i[3]),s=c;break;case"z":case"Z":t.closePath()}}jt(t,e)},No=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&mn(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&mn(t,n,s,"stroke","strokeRect")},mn=(t,e,n,s,r)=>{const o=e&&e.size||1;if(e.shape==="circle")for(let i of n)t.beginPath(),t.arc(i[0],i[1],o,0,P),t[s]();else{const i=o/2;for(let a of n)t[r](a[0]-i,a[1]-i,o,o)}},$o=(t,e,n)=>{n.length<2||(ys(t,n),t.closePath(),jt(t,e))},ys=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,r=e.length;s<r;s++)n=e[s],t.lineTo(n[0],n[1])},Lo=(t,e,n)=>{n.length<2||e.stroke=="none"||(ys(t,n),t.stroke())},Fo=(t,e,n,s,r,o=0)=>{let i;if(o>0)return o=Math.min(Math.min(s,r)/2,o),s-=2*o,r-=2*o,gs(t,e,[["M",[n[0]+o,n[1]]],["h",s],["a",[o,0],[o,o],o],["v",r],["a",[0,o],[-o,o],o],["h",-s],["a",[-o,0],[-o,-o],o],["v",-r],["a",[0,-o],[o,-o],o]]);(i=e.fill)&&i!=="none"&&t.fillRect(n[0],n[1],s,r),(i=e.stroke)&&i!=="none"&&t.strokeRect(n[0],n[1],s,r)},jo=(t,e,n,s,r)=>{let o;(o=e.fill)&&o!=="none"&&t.fillText(s.toString(),n[0],n[1],r),(o=e.stroke)&&o!=="none"&&t.strokeText(s.toString(),n[0],n[1],r)},Dt=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(V(e,"toHiccup")){Dt(t,e.toHiccup(),n);return}if(at(e[0])){for(let o of e)Dt(t,o,n);return}const s=To(t,n,e[1]),r=s?s.attribs:n.attribs;if(!r.__skip){switch(e[0]){case"g":case"defs":Vo(t,s,n,e);break;case"linearGradient":dn(n,e[1].id,vo(t,e[1],e[2]));break;case"radialGradient":dn(n,e[1].id,Mo(t,e[1],e[2]));break;case"points":No(t,r,e[1],e[2]);break;case"packedPoints":Ro(t,r,e[1],e[2]);break;case"line":te(t,r,e[2],e[3]);break;case"lines":Co(t,r,e[2]);break;case"hline":te(t,r,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":te(t,r,[e[2],-1e6],[e[2],1e6]);break;case"polyline":Lo(t,r,e[2]);break;case"polygon":$o(t,r,e[2]);break;case"path":gs(t,r,e[2]);break;case"rect":Fo(t,r,e[2],e[3],e[4],e[5]);break;case"circle":an(t,r,e[2],e[3]);break;case"ellipse":Er(t,r,e[2],e[3],e[4],e[5],e[6]);break;case"arc":an(t,r,e[2],e[3],e[4],e[5]);break;case"text":jo(t,r,e[2],e[3],e[4]);break;case"img":Oo(t,r,e[1],e[2],e[3],e[4],e[5])}s&&ko(t,n,s)}},Vo=(t,e,n,s)=>{const r=s.length,o=s[0]==="g"&&e||n;for(let i=2;i<r;i++)Dt(t,s[i],o)},yt="function",Ho="string",Uo={render(t,e,...n){const s={...e};delete s.__diff,delete s.__normalize;const r=window.devicePixelRatio||1;return r!==1&&(!s.style&&(s.style={}),s.style.width=`${s.width}px`,s.style.height=`${s.height}px`,s.width*=r,s.height*=r),["canvas",s,["g",{__impl:ws,__diff:e.__diff!==!1,__normalize:e.__normalize!==!1,__release:e.__release===!0,__serialize:!1,__clear:e.__clear,scale:r!==1?r:null},...n]]}},ue=(t,e,n)=>{const s=e.getContext("2d");me(!!s,"canvas ctx unavailable");const r=n[1];if(r){if(r.__skip)return;r.__clear!==!1&&s.clearRect(0,0,e.width,e.height)}Dt(s,n)},X=(t,e)=>{if(e==null)return e;if(at(e)){const n=e[0];if(typeof n===yt)return X(t,n.apply(null,[t.ctx,...e.slice(1)]));if(typeof n===Ho){const s=e[1];if(s&&s.__normalize===!1)return e;const r=[e[0],s];for(let o=2,i=e.length;o<i;o++){const a=X(t,e[o]);a!=null&&r.push(a)}return r}}else{if(typeof e===yt)return X(t,e(t.ctx));if(typeof e.toHiccup===yt)return X(t,e.toHiccup(t.ctx));if(typeof e.deref===yt)return X(t,e.deref());if(_e(e)){const n=[];for(let s of e){const r=X(t,s);r!=null&&n.push(r)}return n}}return e},zo=(t,e,n,s,r)=>{const o=s[1];if(o.__skip)return;if(o.__diff===!1)return st(n),ue(t,e,s);let i=o.__impl;if(i&&i!==ws)return i.diffTree(t,e,n,s,r);if(Gn(n,s,"only-distance",et).distance>0)return ue(t,e,s)},ws={createTree:ue,normalizeTree:X,diffTree:zo,hydrateTree:D,getElementById:D,createElement:D,createTextElement:D,replaceChild:D,getChild:D,removeAttribs:D,removeChild:D,setAttrib:D,setContent:D};var Tt;(function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.MIDDLE=4]="MIDDLE"})(Tt||(Tt={}));var O;(function(t){t[t.SHIFT=1]="SHIFT",t[t.CONTROL=2]="CONTROL",t[t.META=4]="META",t[t.ALT=8]="ALT"})(O||(O={}));var I;(function(t){t.ALT="Alt",t.BACKSPACE="Backspace",t.CAPSLOCK="CapsLock",t.CONTEXT_MENU="ContextMenu",t.CONTROL="Control",t.DELETE="Delete",t.DOWN="ArrowDown",t.END="End",t.ENTER="Enter",t.ESC="Escape",t.HELP="Help",t.HOME="Home",t.LEFT="ArrowLeft",t.META="Meta",t.NUM_LOCK="NumLock",t.PAGE_DOWN="PageDown",t.PAGE_UP="PageUp",t.RIGHT="ArrowRight",t.SHIFT="Shift",t.SPACE=" ",t.TAB="Tab",t.UP="ArrowUp"})(I||(I={}));I.ALT,I.BACKSPACE,I.CAPSLOCK,I.CONTEXT_MENU,I.CONTROL,I.DELETE,I.DOWN,I.END,I.ENTER,I.ESC,I.HELP,I.HOME,I.LEFT,I.META,I.NUM_LOCK,I.PAGE_DOWN,I.PAGE_UP,I.RIGHT,I.SHIFT,I.TAB,I.UP;const _n="__NONE__",Is={font:"10px Menlo, monospace",fontSize:10,charWidth:6,baseLine:4,pad:8,globalBg:"#ccc",focus:[0,1,0,1],cursor:[0,0,0,1],cursorBlink:2,bg:[1,1,1,.66],bgDisabled:[1,1,1,.33],bgHover:[1,1,1,.9],fg:[.2,.8,1,1],fgDisabled:[.2,.8,1,.5],fgHover:[.3,.9,1,1],text:[.3,.3,.3,1],textDisabled:[.3,.3,.3,.5],textHover:[.2,.2,.4,1],bgTooltip:[1,1,.8,.85],textTooltip:[0,0,0,1]},Bo=ut(()=>"illegal argument(s)"),xo=t=>{throw new Bo(t)},[ec,kt,nc,sc]=ps("+"),F=-1/0,j=1/0;Object.freeze([F,F]);Object.freeze([j,j]);Object.freeze([1,1]);const Oe=Object.freeze([0,0]);Object.freeze([1,0]);Object.freeze([0,1]);Object.freeze([F,F,F]);Object.freeze([j,j,j]);Object.freeze([1,1,1]);const Go=Object.freeze([0,0,0]);Object.freeze([1,0,0]);Object.freeze([0,1,0]);Object.freeze([0,0,1]);Object.freeze([F,F,F,F]);Object.freeze([j,j,j,j]);Object.freeze([1,1,1,1]);Object.freeze([0,0,0,0]);Object.freeze([1,0,0,0]);Object.freeze([0,1,0,0]);Object.freeze([0,0,1,0]);Object.freeze([0,0,0,1]);const Ss=([t,e])=>`t=${t}-${e};s+=t*t;`,Es="let t,s=0;",De=t=>zt.add(t,ft(t,Ss,"a,b",void 0,"s","",Es)),zt=G();zt.default(Ut(Ss,"a,b",void 0,"s",Es));De(2);De(3);De(4);const[bn,Wo,rc,oc]=ps("-"),[qo,Pt,ic,ac]=Ae(uo,"o,a",void 0,"o",1,ao),Xo=t=>V(t,"copy")?t.copy():qo([],t),Jo=t=>t.map(Xo),As=t=>({...t.attribs}),Zo=(t,e)=>new t(Jo(e.points),As(e));class Te{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=be(n)?[n,n]:n}get type(){return"rect"}copy(){return new Te(Pt([],this.pos),Pt([],this.size),As(this))}max(){return kt([],this.pos,this.size)}toHiccup(){return["rect",this.attribs,this.pos,this.size[0],this.size[1]]}}const gn=Object.getPrototypeOf,Bt=t=>{let e;return t!=null&&typeof t=="object"&&((e=gn(t))===null||gn(e)===null)},Yo=t=>{if(t.length){const e=t[t.length-1];return Bt(e)?t.pop():(e==null&&t.pop(),void 0)}},Ko=t=>{const e=Yo(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]};function ot(...t){return new Te(...Ko(t))}const xt=new Float64Array(1),Qo=new Float32Array(xt.buffer);new Int32Array(xt.buffer);const vs=new Uint32Array(xt.buffer);xt[0]=2,vs[1];const ti=t=>(Qo[0]=t,vs[0]),yn=(t,e)=>(t<<e|t>>>32-e)>>>0,tt=(t,e=2654435761)=>{let n=-1;for(let s=t.length;s-- >0;)n=Math.imul(e,n)+ri(n,ti(t[s]))>>>0;return n},ei=3432918353,ni=461845907,si=3864292196,ri=(t,e)=>(e=Math.imul(yn(Math.imul(e,ei)>>>0,15),ni)>>>0,(Math.imul(yn(t^e,13),5)>>>0)+si>>>0);var he;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(he||(he={}));const ke=Object.freeze({level:he.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});let oi=ke;const q=Symbol();function ii(t,e,n){const s={},r=e?ai(e):{},o=(...i)=>{const a=t(...i),c=s[a]||St(s,r,a)||s[q];return c?c(...i):ge(`missing implementation for: "${a.toString()}"`)};return o.add=(i,a)=>(s[i]&&oi.warn(`overwriting '${i.toString()}' impl`),s[i]=a,!0),o.addAll=i=>{let a=!0;for(let c in i)a=o.add(c,i[c])&&a;return q in i&&o.setDefault(i[q]),a},o.setDefault=i=>o.add(q,i),o.remove=i=>s[i]?(delete s[i],!0):!1,o.callable=(...i)=>{const a=t(...i);return!!(s[a]||St(s,r,a)||s[q])},o.isa=(i,a)=>{let c=r[i];!c&&(r[i]=c=new Set),c.add(a)},o.impls=()=>{const i=new Set(Object.keys(s));for(let a in r)St(s,r,a)&&i.add(a);return s[q]&&i.add(q),i},o.rels=()=>r,o.parents=i=>r[i],o.ancestors=i=>new Set(Ms([],r,i)),o.dependencies=function*(){for(let i in r)for(let a of r[i])yield[i,a];for(let i in s)!r[i]&&(yield[i,void 0])},n&&o.addAll(n),o}const St=(t,e,n)=>{const s=e[n];if(!!s)for(let r of s){let o=t[r]||St(t,e,r);if(o)return o}},Ms=(t,e,n)=>{const s=e[n];if(s)for(let r of s)t.push(r),Ms(t,e,r);return t},ai=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},Pe=t=>Ce.add(t,ft(t,fs,"a,b",void 0,"","+","return ",";")),Ce=G();Ce.default(Ut(lo,"a,b",void 0,"s","let s=0;"));Pe(2);Pe(3);Pe(4);const Re=t=>Ne.add(t,ft(t,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),Ne=G();Ne.default(Ut(([t])=>`sum+=${t}*${t};`,"a",void 0,"sum","let sum=0;"));Re(2);Re(3);Re(4);const[ci,cc,lc,uc]=Ae(ho,oo),li=(t,e,n)=>{const s=bn([],n,e),r=Ne(s);return r>1e-6?Ce(bn([],t,e),s)/r:void 0},ui=(t,e=H)=>t>e?1:t<-e?-1:0,Et=(t,e,n)=>{const s=t[0],r=t[1];return(e[0]-s)*(n[1]-r)-(n[0]-s)*(e[1]-r)},hi=(t,e,n,s=H)=>ui(Et(t,e,n),s),fi=(t,e,n,s=H)=>hi(t,e,n,s)<0,di=(t,e,n,s=H)=>{const r=li(t,e,n);return r!==void 0?zt(t,ci([],e,n,N(r)))<s*s:!1},pi=(t,e,n)=>zt(e,t)<=n*n,mi=(t,e,n,s)=>{const r=fi(e,n,s)?1:-1;return r*Et(e,s,t)>=0&&r*Et(n,e,t)>=0&&r*Et(s,n,t)>=0},_i=(t,e)=>{const n=e.length-1,s=t[0],r=t[1];let o=e[n],i=e[0],a=0;for(let c=0;c<=n;o=i,i=e[++c])a=bi(s,r,o[0],o[1],i[0],i[1],a);return a},bi=(t,e,n,s,r,o,i)=>(s<e&&o>=e||o<e&&s>=e)&&(n<=t||r<=t)?i^~~(n+(e-s)/(o-s)*(r-n)<t):i,$e=G(0),Os=$e.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),gi=$e.add(3,([t,e,n],s,r)=>t>=s[0]&&t<=s[0]+r[0]&&e>=s[1]&&e<=s[1]+r[1]&&n>=s[2]&&n<=s[2]+r[2]);$e.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],o=e[s];if(r<o||r>o+n[s])return!1}return!0});const Le=G(0);Le.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);Le.add(3,([t,e,n],s,r)=>t>=s[0]-r[0]&&t<=s[0]+r[0]&&e>=s[1]-r[1]&&e<=s[1]+r[1]&&n>=s[2]-r[2]&&n<=s[2]+r[2]);Le.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],o=e[s],i=n[s];if(r<o-i||r>o+i)return!1}return!0});const yi=Math.abs,Ds=(t,e,n=H)=>yi(t-e)<=n,Fe=t=>je.add(t,go(t,[Ds,H],([e,n])=>`eq(${e},${n},eps)`,"eq,_eps","a,b,eps=_eps","a,b","","&&","return a.length === b.length && ",";")),je=G();je.default((t,e,n=H)=>V(t,"eqDelta")?t.eqDelta(e,n):V(e,"eqDelta")?e.eqDelta(t,n):wi(t,e,t.length,n));Fe(2);Fe(3);Fe(4);const wi=(t,e,n,s=H,r=0,o=0,i=1,a=1)=>{for(;n>0;n--,r+=i,o+=a)if(!Ds(t[r],e[o],s))return!1;return!0},Ii=(t,e,n=H)=>{for(let s=e.length;s-- >0;)if(je(t,e[s],n))return!0;return!1},Si=t=>t.type,Ts=ii(Si,{points3:"points",quad:"poly",sphere:"circle"},{aabb:(t,e)=>gi(e,t.pos,t.size),circle:(t,e)=>pi(e,t.pos,t.r),line:(t,e)=>di(e,t.points[0],t.points[1]),points:({points:t},e)=>Ii(e,t),poly:(t,e)=>_i(e,t.points)>0,rect:(t,e)=>Os(e,t.pos,t.size),tri:(t,e)=>mi(e,...t.points)}),Ei=new Array(1024),Ai=(t,e=Ei)=>{const n=e.length=t.length;for(let s=0;s<n;s++)e[s]=t.charCodeAt(s);return e},vi=t=>tt(Ai(t)),ks=(t,e)=>t^vi(e),Mi=(t,e,n)=>ks(t+~~n,e),Ps=(t,e,n)=>ks(t+~~n,String(e)),Ve=t=>V(t,"next"),dt=(t,e)=>Ve(t)?t.next(e):t,ee=(t,e,n,s=!1)=>{const r=t.theme,{x:o,y:i,h:a}=dt(e);t.draw&&t.add(["text",{fill:t.textColor(!1)},[o+(s?r.pad:0),i+a/2+r.baseLine],n])},pt=(t,e,n)=>["text",Bt(e)?e:{fill:e},t,n],wn=(t,e,n,s,r)=>[1,0,0,1,e+t.pad,n+r/2+t.baseLine],fe=(t,e,n,s,r)=>[0,-1,1,0,e+s/2+t.baseLine,n+r-t.pad],Oi=(t,e,n,s,r,o,i,a)=>t.resource(e,Ps(n,s,t.disabled),()=>pt([r,o],t.textColor(!1),(i?i+" ":"")+(a?a(s):s))),He=(t,e)=>{const n=t.theme,s=kt(null,[0,10],t.mouse);t.addOverlay(ot(s,[e.length*n.charWidth+n.pad,20],{fill:n.bgTooltip}),pt(kt(null,[4,10+n.baseLine],s),n.textTooltip,e))},Cs=(t,e,n,s)=>{if(t.disabled)return!1;const r=t.activeID,o=(r===""||r===e)&&Ts(n,t.mouse);return o&&(t.setCursor("pointer"),t.hotID=e,t.isMouseDown()&&(t.activeID=e),s&&t.draw&&He(t,s)),o},Rs=t=>{switch(t.key){case I.TAB:t.switchFocus();break;case I.ENTER:case I.SPACE:return!0}},Ct=(t,e,n,s,r,o,i,a,c,l)=>t.resource(n,Mi(s,l,t.disabled),()=>pt(Oe,{transform:e(t.theme,r,o,i,a),fill:t.textColor(c)},l)),ne=(t,e,n,s,r=s,o)=>{const{x:i,y:a,w:c,h:l}=dt(e),u=tt([i,a,c,l]);return Ns(t,n,t.resource(n,u,()=>ot([i,a],[c,l])),u,s?Ct(t,wn,n,u,i,a,c,l,!1,s):void 0,r?Ct(t,wn,n,u,i,a,c,l,!0,r):void 0,o)},Di=(t,e,n,s,r,o=r,i)=>{const{x:a,y:c,w:l,h:u}=dt(e,[1,s]),p=tt([a,c,l,u]);return Ns(t,n,t.resource(n,p,()=>ot([a,c],[l,u])),p,r?Ct(t,fe,n,p,a,c,l,u,!1,r):void 0,o?Ct(t,fe,n,p,a,c,l,u,!0,o):void 0,i)},Ns=(t,e,n,s,r,o,i)=>{t.registerID(e,s);const a=Cs(t,e,n,i),c=t.requestFocus(e);return t.draw&&(n.attribs={fill:a?t.fgColor(!0):t.bgColor(c),stroke:t.focusColor(e)},t.add(n),r&&t.add(a&&o?o:r)),c&&Rs(t)?!0:(t.lastID=e,!t.buttons&&t.hotID===e&&t.activeID===e)};function*Ti(t,e=!0){if(t>0)for(let n=0,s=e?t+1:t;n<s;n++)yield n/t}const In=Math.cos,Sn=Math.sin,$s=G(1),ki=$s.add(2,(t,e,n=Oe)=>kt(t||e,Br(e[1],e[0]),n));$s.add(3,(t,e,n=Go)=>{const s=e[0],r=e[1],o=e[2],i=In(r);return $r(t||e,s*i*In(o)+n[0],s*i*Sn(o)+n[1],s*Sn(r)+n[2])});class Pi{constructor(e=[],n){this.points=e,this.attribs=n}*[Symbol.iterator](){yield*this.points}}class Ue extends Pi{get type(){return"poly"}copy(){return Zo(Ue,this)}toHiccup(){return["polygon",this.attribs,this.points]}}const Ls=(t,e)=>new Ue(t,e),Ci=[1,1];class ze{constructor(e,n,s,r,o,i,a){this.parent=e,this.cols=o,this.x=n,this.y=s,this.width=r,this.cellW=(r-(o-1)*a)/o,this.cellH=i,this.cellWG=this.cellW+a,this.cellHG=i+a,this.gap=a,this.currCol=0,this.currRow=0,this.rows=0}colsForWidth(e){return Math.ceil(e/this.cellWG)}rowsForHeight(e){return Math.ceil(e/this.cellHG)}spansForSize(e,n){const s=be(e)?[e,n]:e;return[this.colsForWidth(s[0]),this.rowsForHeight(s[1])]}next(e=Ci){const{cellWG:n,cellHG:s,gap:r,cols:o}=this,i=Math.min(e[0],o),a=e[1];this.currCol>0?this.currCol+i>o&&(this.currCol=0,this.currRow=this.rows):this.currRow=this.rows;const c=a*s-r,l={x:this.x+this.currCol*n,y:this.y+this.currRow*s,w:i*n-r,h:c,cw:this.cellW,ch:this.cellH,gap:r};return this.propagateSize(a),this.currCol=Math.min(this.currCol+i,o)%o,l}nextSquare(){const e=this.next([1,Math.ceil(this.cellW/(this.cellH+this.gap))+1]);return e.h=e.w,e}nest(e,n){const{x:s,y:r,w:o}=this.next(n);return new ze(this,s,r,o,e,this.cellH,this.gap)}propagateSize(e){let n=this.rows;this.rows=n=Math.max(n,this.currRow+e);const s=this.parent;s&&s.propagateSize(n)}}const Fs=(t,e,n,s=1,r=16,o=4)=>new ze(null,t,e,n,s,r,o),En=(t,e,n,s,r,o,i)=>{const a=t.state(n,()=>!1),c=Ve(e)?e.nest(1,[1,a?r.length:1]):Fs(e.x,e.y,e.w,1,e.ch,e.gap);let l;const u=c.next(),{x:p,y:f,w:d,h}=u,m=tt([p,f,d,h,~~t.disabled]),b=p+d-t.theme.pad-4,_=f+h/2,y=t.draw;if(a){const g=ne(t,u,`${n}-title`,o);if(y&&t.add(t.resource(n,m+1,()=>vn(t,b,_,!0))),g)t.setState(n,!1);else{for(let w=0,S=r.length;w<S;w++)ne(t,c,`${n}-${w}`,r[w])&&(w!==s&&(l=w),t.setState(n,!1));if(t.focusID.startsWith(`${n}-`))switch(t.key){case I.ESC:t.setState(n,!1);break;case I.UP:return An(t,n,Mr(s-1));case I.DOWN:return An(t,n,Math.min(r.length-1,s+1))}}}else ne(t,u,`${n}-${s}`,r[s],o,i)&&t.setState(n,!0),y&&t.add(t.resource(n,m+2,()=>vn(t,b,_,!1)));return l},An=(t,e,n)=>(t.focusID=`${e}-${n}`,n),vn=(t,e,n,s)=>{const r=s?2:-2;return Ls([[e-4,n+r],[e+4,n+r],[e,n-r]],{fill:t.textColor(!1)})},Gt=(t,e,n)=>n!==e?(t-e)/(n-e):0,js=(t,e,n,s,r)=>s+(r-s)*Gt(t,e,n),Ri=(t,e,n,s,r)=>s+(r-s)*N(Gt(t,e,n)),Ni=(t,e,n)=>t+(e-t)*n,$i=t=>Gr(t[1],t[0]),Li=$i,Fi=(t,e,n,s="ew-resize")=>{if(t.disabled)return!1;const r=t.activeID,o=r===e||r===""&&Ts(n,t.mouse);return o&&(t.setCursor(s),t.hotID=e),o},Be=(t,e,n,s)=>ae(Or(t,s),e,n),Vs=(t,e,n,s,r)=>{switch(t.key){case I.TAB:t.switchFocus();break;case I.UP:case I.DOWN:{const o=(t.key===I.UP?s:-s)*(t.isShiftDown()?5:1);return Be(r+o,e,n,s)}}},ji=(t,e,n,s,r,o,i)=>{let a=Li(Wo([],t,e))-n;return a<-.5&&(a+=P),Be(js(Math.min(a/(P-s)),0,1,r,o),r,o,i)},Mn=(t,e)=>t/2*(1+Math.sin(ie+e/2)),On=(t,e,n,s,r=12)=>e>1?x(o=>ki(null,[e,Ni(n,s,o)],t),Ti(Math.max(1,Math.abs(s-n)/(Ft/r))|0)):[t],Vi=(t,e,n,s,r,o,i,a,c,l,u,p)=>{let f,d;return Ve(e)?(f=Mn(e.cellW,a),d=e.next([1,e.rowsForHeight(f)+1])):(f=Mn(e.cw,a),d=e),Hi(t,n,d.x,d.y,d.w,f,s,r,o,i,a,c,0,f+d.ch/2+t.theme.baseLine,l,u,p)},Hi=(t,e,n,s,r,o,i,a,c,l,u,p,f,d,h,m,b)=>{const _=r/2,y=tt([n,s,_]);t.registerID(e,y);const g=[n+_,s+_],w=ie+u/2,S=ie+P-u/2,E=t.draw,$=t.activeID,C=!t.disabled&&($===e||$===""&&Os(t.mouse,[n,s],[r,o]));let v=l,W;C&&(t.setCursor("pointer"),t.hotID=e,t.isMouseDown()&&(t.activeID=e,W=ji(t.mouse,g,w,u,i,a,c)),b&&E&&He(t,b));const qe=t.requestFocus(e);if(E){const qs=w+(P-u)*Gt(v,i,a),Xs=_*p,Xe=Ri(_,15,80,12,30),Je=Ye=>()=>Ls([...On(g,_,w,Ye,Xe),...On(g,Xs,Ye,w,Xe)],{}),Xt=t.resource(e,y,Je(S)),Ze=t.resource(e,v,Je(qs)),Js=Oi(t,e,y,v,n+f,s+d,h,m);Xt.attribs.fill=t.bgColor(C||qe),Xt.attribs.stroke=t.focusColor(e),Ze.attribs.fill=t.fgColor(C),t.add(Xt,Ze,Js)}return qe&&(v=Vs(t,i,a,c,v))!==void 0?v:(t.lastID=e,W)},Ui=(t,e,n,s,r,o,i,a,c,l,u)=>{const p=dt(e,[1,a]);return zi(t,n,p.x,p.y,p.w,p.h,s,r,o,i,c,l,u)},zi=(t,e,n,s,r,o,i,a,c,l,u,p,f)=>{const d=t.theme,h=tt([n,s,r,o]);t.registerID(e,h);const m=t.resource(e,h,()=>ot([n,s],[r,o],{})),b=s+o,_=Fi(t,e,m,"ns-resize"),y=t.draw;let g=l,w;_&&(t.isMouseDown()&&(t.activeID=e,w=Be(js(t.mouse[1],b-1,s,i,a),i,a,c)),f&&y&&He(t,f));const S=t.requestFocus(e);if(y){const E=t.resource(e,g,()=>{const C=Gt(g,i,a)*(o-1);return ot([n,b-C],[r,C],{})}),$=t.resource(e,Ps(h,g,t.disabled),()=>pt(Oe,{transform:fe(d,n,s,r,o),fill:t.textColor(!1)},(u?u+" ":"")+(p?p(g):g)));E.attribs.fill=t.fgColor(_),m.attribs.fill=t.bgColor(_||S),m.attribs.stroke=t.focusColor(e),t.add(m,E,$)}return S&&(g=Vs(t,i,a,c,g))!==void 0?g:(t.lastID=e,w)};class Bi{constructor(e){this.mouse=[-1e3,-1e3],this.prevMouse=[-1e3,-1e3],this.key=this.prevKey="",this.buttons=this.prevButtons=this.modifiers=this.prevModifiers=0,this.hotID=this.activeID=this.focusID=this.lastID="",this.currIDs=new Set,this.prevIDs=new Set,this.resources=new Map,this.sizes=new Map,this.states=new Map,this.layers=[[],[]],this.attribs={},this.disabledStack=[!1],this.setTheme(e.theme||{}),this.draw=!0,this.t0=Date.now()}get theme(){const e=this.themeStack;return e[e.length-1]}get disabled(){const e=this.disabledStack;return e[e.length-1]}clear(){this.layers[0].length=0,this.layers[1].length=0,this.themeStack.length=1,this.disabledStack.length=1}setMouse(e,n){return Pt(this.prevMouse,this.mouse),Pt(this.mouse,e),this.prevButtons=this.buttons,this.buttons=n,this}setKey(e){return e.type==="keydown"&&(this.prevKey=this.key,this.key=e.key),this.prevModifiers=this.modifiers,this.modifiers=~~e.shiftKey*O.SHIFT|~~e.ctrlKey*O.CONTROL|~~e.metaKey*O.META|~~e.altKey*O.ALT,this}setTheme(e){this.themeStack=[{...Is,...e}]}beginTheme(e){const n=this.themeStack;n.push({...n[n.length-1],...e})}endTheme(){Dn(this.themeStack)}withTheme(e,n){this.beginTheme(e);const s=n();return this.themeStack.pop(),s}beginDisabled(e=!0){this.disabledStack.push(e)}endDisabled(){Dn(this.disabledStack)}withDisabled(e,n){this.disabledStack.push(e);const s=n();return this.disabledStack.pop(),s}requestFocus(e){return this.disabled?!1:this.focusID===""||this.activeID===e?(this.focusID=e,!0):this.focusID===e}switchFocus(){this.focusID=this.isShiftDown()?this.lastID:"",this.key=""}isMouseDown(){return(this.buttons&Tt.LEFT)>0}isShiftDown(){return(this.modifiers&O.SHIFT)>0}isControlDown(){return(this.modifiers&O.CONTROL)>0}isMetaDown(){return(this.modifiers&O.META)>0}isAltDown(){return(this.modifiers&O.ALT)>0}isPrevMouseDown(){return(this.prevButtons&Tt.LEFT)>0}isPrevShiftDown(){return(this.prevModifiers&O.SHIFT)>0}isPrevControlDown(){return(this.prevModifiers&O.CONTROL)>0}isPrevMetaDown(){return(this.prevModifiers&O.META)>0}isPrevAltDown(){return(this.prevModifiers&O.ALT)>0}begin(e=!0){this.hotID="",this.cursor="default",this.draw=e,this.clear(),this.time=(Date.now()-this.t0)*.001}end(){this.buttons?this.activeID===""&&(this.activeID=_n,this.focusID=_n,this.lastID=""):this.activeID="",this.key===I.TAB&&(this.focusID=""),this.key="",this.gc()}gc(){const{currIDs:e,prevIDs:n}=this;for(let s of n)e.has(s)||(this.resources.delete(s),this.sizes.delete(s),this.states.delete(s));this.prevIDs=e,this.currIDs=n,n.clear()}bgColor(e){return this.disabled?this.theme.bgDisabled:e?this.theme.bgHover:this.theme.bg}fgColor(e){return this.disabled?this.theme.fgDisabled:e?this.theme.fgHover:this.theme.fg}textColor(e){return this.disabled?this.theme.textDisabled:e?this.theme.textHover:this.theme.text}focusColor(e){return this.focusID===e?this.theme.focus:void 0}textWidth(e){return this.theme.charWidth*e.length}registerID(e,n){this.currIDs.add(e),this.sizes.get(e)!==n&&(this.sizes.set(e,n),this.resources.delete(e))}resource(e,n,s){let r,o=this.resources.get(e);return!o&&this.resources.set(e,o=new Map),o.get(n)||(o.set(n,r=s()),r)}state(e,n){let s=this.states.get(e);return s!==void 0||this.states.set(e,s=n()),s}setState(e,n){this.states.set(e,n)}setCursor(e){this.cursor=e}add(...e){this.layers[0].push(...e)}addOverlay(...e){this.layers[1].push(...e)}toHiccup(){return["g",{font:this.theme.font},...this.layers[0],...this.layers[1]]}}const Dn=t=>t.length>1&&t.pop(),xi=t=>typeof t=="boolean";let Gi=0;const Wi=()=>Gi++,Z=(t,e)=>!e||!e.id?{...e,id:t+"-"+Wi()}:e,Hs=t=>typeof t=="function";var A;(function(t){t[t.IDLE=0]="IDLE",t[t.ACTIVE=1]="ACTIVE",t[t.DONE=2]="DONE",t[t.UNSUBSCRIBED=3]="UNSUBSCRIBED",t[t.ERROR=4]="ERROR"})(A||(A={}));var R;(function(t){t[t.NEVER=0]="NEVER",t[t.FIRST=1]="FIRST",t[t.LAST=2]="LAST"})(R||(R={}));let L=ke;const qi=t=>t[t.length-1];class it{constructor(e,n){this.wrapped=e,this.last=z,this.state=A.IDLE,this.subs=[],n=Z("sub",{closeIn:R.LAST,closeOut:R.LAST,cache:!0,...n}),this.parent=n.parent,this.id=n.id,this.closeIn=n.closeIn,this.closeOut=n.closeOut,this.cacheLast=n.cache,n.xform&&(this.xform=n.xform(rs()))}deref(){return this.last!==z?this.last:void 0}getState(){return this.state}setState(e){this.state=e}subscribe(e,n={}){this.ensureState();let s;return e instanceof it&&!n.xform?(e.ensureState(),me(!e.parent,`sub '${e.id}' already has a parent`),e.parent=this,s=e):s=new it(e,{...n,parent:this}),this.subs.push(s),this.setState(A.ACTIVE),s.setState(A.ACTIVE),this.last!=z&&s.next(this.last),s}transform(...e){let n,s;return Bt(qi(e))&&(s=e.pop(),n={error:s.error}),this.subscribe(n,Z("xform",e.length>0?{...s,xform:ts(...e)}:s))}map(e,n){return this.transform(x(e),n||{})}unsubscribe(e){return e?this.unsubscribeChild(e):this.unsubscribeSelf()}unsubscribeSelf(){return L.debug(this.id,"unsub self"),this.parent&&this.parent.unsubscribe(this),this.state<A.UNSUBSCRIBED&&(this.state=A.UNSUBSCRIBED),this.release(),!0}unsubscribeChild(e){L.debug(this.id,"unsub child",e.id);const n=this.subs.indexOf(e);return n>=0?(this.subs.splice(n,1),(this.closeOut===R.FIRST||!this.subs.length&&this.closeOut!==R.NEVER)&&this.unsubscribe(),!0):!1}next(e){this.state>=A.DONE||(this.xform?this.dispatchXform(e):this.dispatch(e))}done(){L.debug(this.id,"entering done()"),!(this.state>=A.DONE)&&(this.xform&&!this.dispatchXformDone()||(this.state=A.DONE,this.dispatchTo("done")&&this.state<A.UNSUBSCRIBED&&this.unsubscribe(),L.debug(this.id,"exiting done()")))}error(e){const n=this.wrapped,s=n&&n.error;return s&&L.debug(this.id,"attempting wrapped error handler"),s&&n.error(e)||this.unhandledError(e)}unhandledError(e){return(L!==ke?L:console).warn(this.id,"unhandled error:",e),this.unsubscribe(),this.state=A.ERROR,!1}dispatchTo(e,n){let s=this.wrapped;if(s)try{s[e]&&s[e](n)}catch(o){if(!this.error(o))return!1}const r=e==="next"?this.subs:[...this.subs];for(let o=r.length;o-- >0;){s=r[o];try{s[e]&&s[e](n)}catch(i){if(e==="error"||!s.error||!s.error(i))return this.unhandledError(i)}}return!0}dispatch(e){L.debug(this.id,"dispatch",e),this.cacheLast&&(this.last=e),this.dispatchTo("next",e)}dispatchXform(e){let n;try{n=this.xform[2]([],e)}catch(s){this.error(s);return}this.dispatchXformVals(n)&&B(n)&&this.done()}dispatchXformDone(){let e;try{e=this.xform[1]([])}catch(n){return this.error(n)}return this.dispatchXformVals(e)}dispatchXformVals(e){const n=rt(e);for(let s=0,r=n.length;s<r&&this.state<A.DONE;s++)this.dispatch(n[s]);return this.state<A.ERROR}ensureState(){this.state>=A.DONE&&jn(`operation not allowed in state ${this.state}`)}release(){this.subs.length=0,delete this.parent,delete this.xform,delete this.last}}function xe(t,e){return new Xi(t,e)}class Xi extends it{constructor(e,n){const[s,r]=Hs(e)?[e,n||{}]:[void 0,e||{}];super(r.error?{error:r.error}:void 0,Z("stream",r)),this.src=s,this._inited=!1}subscribe(e,n={}){const s=super.subscribe(e,n);if(!this._inited){if(this.src)try{this._cancel=this.src(this)||(()=>{})}catch(r){let o=this.wrapped;(!o||!o.error||!o.error(r))&&this.unhandledError(r)}this._inited=!0}return s}unsubscribe(e){const n=super.unsubscribe(e);return n&&(!e||(!this.subs||!this.subs.length)&&this.closeOut!==R.NEVER)&&this.cancel(),n}done(){this.cancel(),super.done(),delete this.src,delete this._cancel}error(e){return super.error(e)?!0:(this.cancel(),!1)}cancel(){if(this._cancel){L.debug(this.id,"cancel");const e=this._cancel;delete this._cancel,e()}}}const Ji=(t,e,n=!1,s)=>xe(r=>{let o=i=>r.next(i);return t.addEventListener(e,o,n),()=>t.removeEventListener(e,o,n)},Z(`event-${e}`,s)),de=(t,e,n=!1,s)=>Ji(t,e,n,s),Zi=(t,e)=>t===R.FIRST||t===R.LAST&&!e,Yi=(t,e)=>{let n=!0;for(let s of e)n=t.removeID(s)&&n;return n},Ki=t=>new Qi(t);class Qi extends it{constructor(e){e=e||{},super(void 0,Z("streammerge",e)),this.sources=new Map,e.src&&this.addAll(e.src)}add(e){this.ensureState(),this.sources.set(e,e.subscribe({next:n=>n instanceof it?this.add(n):this.next(n),done:()=>this.markDone(e),__owner:this},{id:`in-${e.id}`}))}addAll(e){for(let n of e)this.add(n)}remove(e){const n=this.sources.get(e);return n?(this.sources.delete(e),n.unsubscribe(),!0):!1}removeID(e){for(let n of this.sources)if(n[0].id===e)return this.remove(n[0]);return!1}removeAll(e){let n=!0;for(let s of e)n=this.remove(s)&&n;return n}removeAllIDs(e){return Yi(this,e)}unsubscribe(e){if(!e){for(let n of this.sources.values())n.unsubscribe();this.state=A.DONE,this.sources.clear()}return super.unsubscribe(e)}markDone(e){this.remove(e),Zi(this.closeIn,this.sources.size)&&this.done()}}const ta=new Set(["mousedown","touchmove","touchstart","mousemove"]),ea=new Set(["mouseup","touchend","touchcancel"]),na=["mousemove","mousedown","touchstart","wheel"],sa={touchstart:"start",touchmove:"drag",touchend:"end",touchcancel:"end",mousedown:"start",mouseup:"end",wheel:"zoom"},ra=(t,e)=>{const n={id:"gestures",zoom:1,absZoom:!0,minZoom:.25,maxZoom:4,smooth:1,eventOpts:{capture:!0},preventDefault:!0,preventScrollOnZoom:!0,preventContextMenu:!0,local:!0,scale:!1,...e},s=[];let r=ae(n.zoom,n.minZoom,n.maxZoom),o=0,i=0,a;const c=t===document.body,l=["touchend","touchcancel","touchmove","mouseup"];!c&&l.push("mousemove"),n.preventContextMenu&&t.addEventListener("contextmenu",h=>h.preventDefault());const u=(h,m,b,_)=>{const y=h==="mousedown"||h==="touchstart";for(let g of m){const w=g.identifier||0,S=Tn(g,b,n.local,n.scale);let E=s.find($=>$.id===w);!E&&y&&(E={id:w,start:S},s.push(E),i++),E&&(E.pos=S,E.delta=[S[0]-E.start[0],S[1]-E.start[1]],_&&(E.force=g.force))}y&&!a&&(a=l.map(g=>se(document.body,g,n,"-temp")),d.addAll(a),!c&&d.removeID("mousemove"))},p=h=>{for(let m of h){const b=m.identifier||0,_=s.findIndex(y=>y.id===b);_!==-1&&(s.splice(_,1),i--)}i===0&&(d.removeAll(a),!c&&d.add(se(t,"mousemove",n)),a=void 0)},f=h=>{const m=n.smooth*("wheelDeltaY"in h?-h.wheelDeltaY/120:h.deltaY/40);r=n.absZoom?ae(r+m,n.minZoom,n.maxZoom):m,o=m},d=Ki({src:na.map(h=>se(t,h,n)),xform:x(h=>{n.preventDefault&&h.preventDefault();const m=h.type,b=oa(m,!!a);let _=!!h.touches,y=_?Array.from(h.changedTouches):[h];const g=t.getBoundingClientRect();return ta.has(m)?u(m,y,g,_):ea.has(m)?p(y):b==="zoom"&&f(h),{event:h,pos:Tn(y[0],g,n.local,n.scale),buttons:_?s.length:h.buttons,type:b,active:s,zoom:r,zoomDelta:o,isTouch:_}})});return d},se=(t,e,n,s="")=>{let r=n.eventOpts;return e==="wheel"&&n.preventScrollOnZoom&&(r=xi(r)?{capture:r,passive:!1}:{...r,passive:!1}),de(t,e,r,{id:e+s})},oa=(t,e)=>t==="mousemove"?e?"drag":"move":sa[t],Tn=(t,e,n,s)=>{let r=t.clientX,o=t.clientY;if(n&&(r-=e.left,o-=e.top),s){const i=window.devicePixelRatio||1;r*=i,o*=i}return[r|0,o|0]},ia=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u",aa=(t,e)=>(e=Z("interval",{num:1/0,...e}),xe(n=>{let s=0,r=e.num;n.next(s++);let o=setInterval(()=>{n.next(s++),--r<=0&&(clearInterval(o),n.closeIn!==R.NEVER&&n.done())},t);return()=>clearInterval(o)},e)),ca=t=>ia()?aa(16,t):xe(e=>{let n=0,s=!0;const r=()=>{s&&e.next(n++),s&&(o=requestAnimationFrame(r))};let o=requestAnimationFrame(r);return()=>{s=!1,cancelAnimationFrame(o)}},Z("raf",t)),la=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,ua={button:1,option:1,script:1,style:1,text:1,textarea:1,title:1},Ge=t=>t.split(" ").reduce((e,n)=>(e[n]=!0,e),{}),ha=Ge("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view");Ge("area base br col command embed hr img input keygen link meta param source stop track use wbr ?xml");Ge("animate circle ellipse line path polygon polyline rect");const fa=t=>t!=null&&typeof t.deref=="function",Rt=t=>fa(t)?t.deref():t,da=t=>{let e="",n;for(let s in t)n=Rt(t[s]),Hs(n)&&(n=n(t)),n!=null&&(e+=`${s}:${n};`);return e},pa=t=>Object.keys(t).reduce((e,n)=>(e.push(`${n}: ${t[n]}`),e),[]).join(" "),ma="http://www.w3.org/2000/svg",Wt=at,Us=_e,zs=Y,Bs=(t,e)=>e.__init&&e.__init.apply(e.__this,[t,...e.__args]),At=(t,e,n,s,r,o=!0)=>{if(Wt(s)){const i=s[0];if(typeof i=="function")return At(t,e,n,i.apply(null,[t.ctx,...s.slice(1)]),r);const a=s[1];if(a.__impl)return a.__impl.createTree(t,n,s,r,o);const c=e.createElement(n,i,a,r);if(s.length>2){const l=s.length;for(let u=2;u<l;u++)At(t,e,c,s[u],void 0,o)}return o&&Bs(c,s),c}if(Us(s)){const i=[];for(let a of s)i.push(At(t,e,n,a,r,o));return i}return s==null?n:e.createTextElement(n,s)},vt=(t,e,n,s,r=0)=>{if(Wt(s)){const o=e.getChild(n,r);typeof s[0]=="function"&&vt(t,e,n,s[0].apply(null,[t.ctx,...s.slice(1)]),r);const i=s[1];if(i.__impl)return i.__impl.hydrateTree(t,n,s,r);Bs(o,s);for(let a in i)a[0]==="o"&&a[1]==="n"&&e.setAttrib(o,a,i[a]);for(let a=s.length,c=2;c<a;c++)vt(t,e,o,s[c],c-2)}else if(Us(s))for(let o of s)vt(t,e,n,o,r),r++},_a=(t,e,n,s)=>{const r=ha[e]?document.createElementNS(ma,e):document.createElement(e);return n&&Ia(r,n),xs(t,r,s)},ba=(t,e,n)=>xs(t,document.createTextNode(e),n),xs=(t,e,n)=>t?n===void 0?t.appendChild(e):t.insertBefore(e,t.children[n]):e,ga=(t,e)=>t.children[e],ya=(t,e,n,s,r,o=!0)=>(e.removeChild(n,s),e.createTree(t,n,r,s,o)),wa=(t,e)=>t.textContent=e,Ia=(t,e)=>{for(let n in e)Gs(t,n,e[n],e);return t},Gs=(t,e,n,s)=>{if(e.startsWith("__"))return;const r=e[0]==="o"&&e[1]==="n";if(!r&&typeof n=="function"&&(n=n(s)),n!==void 0&&n!==!1)switch(e){case"style":Aa(t,n);break;case"value":Sa(t,n);break;case"prefix":t.setAttribute(e,zs(n)?n:pa(n));break;case"accesskey":t.accessKey=n;break;case"contenteditable":t.contentEditable=n;break;case"tabindex":t.tabIndex=n;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":t[e]=n;break;default:r?va(t,e.substring(2),n):t.setAttribute(e,n===!0?"":n)}else t[e]!=null?t[e]=null:t.removeAttribute(e);return t},Sa=(t,e)=>{let n;switch(t.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if((n=t.value)!==void 0&&typeof e=="string"){const s=e.length-(n.length-(t.selectionStart||0));t.value=e,t.selectionStart=t.selectionEnd=s;break}default:t.value=e}},Ea=(t,e,n)=>{for(let s=e.length;s-- >0;){const r=e[s];r[0]==="o"&&r[1]==="n"?Ma(t,r.substring(2),n[r]):t.hasAttribute(r)?t.removeAttribute(r):t[r]=null}},Aa=(t,e)=>(t.setAttribute("style",da(e)),t),va=(t,e,n)=>zs(n)?t.setAttribute("on"+e,n):Wt(n)?t.addEventListener(e,...n):t.addEventListener(e,n),Ma=(t,e,n)=>Wt(n)?t.removeEventListener(e,...n):t.removeEventListener(e,n),Oa=(t,e)=>{const n=t.children[e];n!==void 0&&t.removeChild(n)},kn=(t,e)=>{if(e=Rt(e),e==null)return t;if(Y(e))return t+" "+e;const n=new Set(t.split(" "));for(let s in e)Rt(e[s])?n.add(s):n.delete(s);return[...n].join(" ")},Da=(t,e,n)=>{e&&(t.id=e);let s=Rt(t.class);return n?(n=n.replace(/\./g," "),t.class=s?kn(n,s):n):s&&(t.class=Y(s)?s:kn("",s)),t},Nt=at,Ta=_e,ka=Bt,Pa=(t,e)=>{let n=t[0],s=ka(t[1]),r,o,i;return(typeof n!="string"||!(r=la.exec(n)))&&xo(`${n} is not a valid tag name`),o=r[1],n===o&&s&&(!e||t[1].key)?t:(i=Da(s?{...t[1]}:{},r[2],r[3]),i.__skip&&t.length<3?[o,i]:[o,i,...t.slice(s?2:1)])},Ca=(t,e)=>U(e,t,t.ctx,[0],t.keys!==!1,t.span!==!1),U=(t,e,n,s,r,o)=>{if(t!=null){if(Nt(t)){if(t.length===0)return;let i,a=t[1],c;if(a&&(c=a.__impl)&&(c=c.normalizeTree))return c(e,t);const l=t[0];if(typeof l=="function")return U(l.apply(null,[n,...t.slice(1)]),e,n,s,r,o);if(typeof l.render=="function"){const u=[n,...t.slice(1)];return i=U(l.render.apply(l,u),e,n,s,r,o),Nt(i)&&(i.__this=l,i.__init=l.init,i.__release=l.release,i.__args=u),i}return i=Pa(t,r),a=i[1],a.__normalize===!1?i:(r&&a.key===void 0&&(a.key=s.join("-")),i.length>2?Ra(i,a,e,n,s,r,o):i)}return typeof t=="function"?U(t(n),e,n,s,r,o):typeof t.toHiccup=="function"?U(t.toHiccup(e.ctx),e,n,s,r,o):typeof t.deref=="function"?U(t.deref(),e,n,s,r,o):o?["span",r?{key:s.join("-")}:{},t.toString()]:t.toString()}},Ra=(t,e,n,s,r,o,i)=>{const a=t[0],c=[a,e];i=i&&!ua[a];for(let l=2,u=2,p=0,f=t.length;l<f;l++){let d=t[l];if(d!=null){const h=Nt(d);if(h&&Nt(d[0])||!h&&Ta(d))for(let m of d)m=U(m,n,s,r.concat(p),o,i),m!==void 0&&(c[u++]=m),p++;else d=U(d,n,s,r.concat(p),o,i),d!==void 0&&(c[u++]=d),p++}}return c},Na={createTree(t,e,n,s,r){return At(t,this,e,n,s,r)},hydrateTree(t,e,n,s){return vt(t,this,e,n,s)},diffTree(t,e,n,s,r){Wn(t,this,e,n,s,r)},normalizeTree:Ca,getElementById(t){return document.getElementById(t)},getChild:ga,createElement:_a,createTextElement:ba,replaceChild(t,e,n,s,r){ya(t,this,e,n,s,r)},removeChild:Oa,setContent:wa,removeAttribs:Ea,setAttrib:Gs},$a=(t,e)=>Y(t)?e.getElementById(t):t,La=(t,e)=>{if(t==null||!e||!e.length)return t;const n={...t};for(let s of e){const r=n[s];V(r,"deref")&&(n[s]=r.deref())}return n};function Ws(...t){return t.length>2&&as(Ws,t,os)||(([e,n,s])=>{const[r,o,i]=t[0];let a=t.length>1&&t[1]!=null?t[1]:r();return[e,c=>{let l=o(a);return l!==a&&(c=rt(s(c,l))),a=l,n(c)},(c,l)=>(a=i(a,l),B(a)?ns(s(c,a.deref())):s(c,a))]})}const Fa=(t={},e=Na)=>{const n={root:"app",...t},s=$a(n.root,e);return Ws([()=>[],r=>r,(r,o)=>(n.ctx=La(t.ctx,n.autoDerefKeys),o=e.normalizeTree(n,o),o!=null?(n.hydrate?(e.hydrateTree(n,s,o),n.hydrate=!1):e.diffTree(n,s,r,o,0),o):r)])},ja=(t,e,n)=>{let s,r,o=0,i=0;return{init(a,c,...l){s=a,re(s,s.width,s.height),r=s.getContext(t,n),i=Date.now(),e.init&&e.init(s,r,c,...l),e.update&&e.update(s,r,c,i,o++,...l)},render(a,...c){return r&&e.update&&e.update(s,r,a,Date.now()-i,o++,...c),["canvas",c[0]]},release(a,...c){e.release&&e.release(s,r,a,...c)}}},Pn=(t,e)=>ja("2d",t,e),Cn=1/2**32;class Va{float(e=1){return this.int()*Cn*e}norm(e=1){return(this.int()*Cn-.5)*2*e}minmax(e,n){return this.float()*(n-e)+e}}class $t extends AudioWorkletNode{baseURL;json;json_object;parse_ui;parse_group;parse_items;parse_item;output_handler;inputs_items;outputs_items;descriptor;fPitchwheelLabel;fCtrlLabel=[];gui;presets;constructor(e,n,s){super(e,"processor",s),this.baseURL=n,this.json=s.processorOptions.json,this.json_object=JSON.parse(this.json),this.parse_ui=function(o,i){for(var a=0;a<o.length;a++)this.parse_group(o[a],i)},this.parse_group=function(o,i){o.items&&this.parse_items(o.items,i)},this.parse_items=function(o,i){for(var a=0;a<o.length;a++)this.parse_item(o[a],i)},this.parse_item=function(o,i){if(o.type==="vgroup"||o.type==="hgroup"||o.type==="tgroup")this.parse_items(o.items,i);else if(o.type==="hbargraph"||o.type==="vbargraph")i.outputs_items.push(o.address);else if(o.type==="vslider"||o.type==="hslider"||o.type==="button"||o.type==="checkbox"||o.type==="nentry"){if(i.inputs_items.push(o.address),i.descriptor.push(o),o.meta!==void 0)for(var a=0;a<o.meta.length;a++)o.meta[a].midi!==void 0&&(o.meta[a].midi.trim()==="pitchwheel"?i.fPitchwheelLabel.push({path:o.address,min:parseFloat(o.min),max:parseFloat(o.max)}):o.meta[a].midi.trim().split(" ")[0]==="ctrl"&&i.fCtrlLabel[parseInt(o.meta[a].midi.trim().split(" ")[1])].push({path:o.address,min:parseFloat(o.min),max:parseFloat(o.max)}));var c="set"+o.address,l="get"+o.address;c=c.replace(/\/./g,u=>u.substr(1,1).toUpperCase()),l=l.replace(/\/./g,u=>u.substr(1,1).toUpperCase()),i[c]=u=>{i.setParamValue(o.address,u)},i[l]=()=>i.getParamValue(o.address)}},this.output_handler=null,this.inputs_items=[],this.outputs_items=[],this.descriptor=[],this.fPitchwheelLabel=[],this.fCtrlLabel=new Array(128);for(var r=0;r<this.fCtrlLabel.length;r++)this.fCtrlLabel[r]=null;this.parse_ui(this.json_object.ui,this),this.port.onmessage=this.handleMessage.bind(this);try{this.parameters&&this.parameters.forEach(o=>o.automationRate="k-rate")}catch{}}handleMessage(e){var n=e.data;this.output_handler&&this.output_handler(n.path,n.value)}destroy(){this.port.postMessage({type:"destroy"}),this.port.close()}getJSON(){return this.json}getOutputItems(){return this.outputs_items}setParamValue(e,n){this.parameters.get(e)?.setValueAtTime(n,0)}setParam(e,n){this.parameters.get(e)?.setValueAtTime(n,0)}getParamValue(e){return this.parameters.get(e)?.value}getParam(e){return this.parameters.get(e)?.value}setOutputParamHandler(e){this.output_handler=e}getOutputParamHandler(){return this.output_handler}getNumInputs(){return parseInt(this.json_object.inputs)}getNumOutputs(){return parseInt(this.json_object.outputs)}inputChannelCount(){return parseInt(this.json_object.inputs)}outputChannelCount(){return parseInt(this.json_object.outputs)}getParams(){return this.inputs_items}getDescriptor(){var e={};for(const n in this.descriptor)this.descriptor.hasOwnProperty(n)&&this.descriptor[n].label!="bypass"&&(e=Object.assign({[this.descriptor[n].label]:{minValue:this.descriptor[n].min,maxValue:this.descriptor[n].max,defaultValue:this.descriptor[n].init}},e));return e}ctrlChange(e,n,s){const r=this.fCtrlLabel[n];if(r!==null&&Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o].path;this.setParamValue(i,$t.remap(s,0,127,r[o].min,r[o].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}pitchWheel(e,n){for(var s=0;s<this.fPitchwheelLabel.length;s++){var r=this.fPitchwheelLabel[s];this.setParamValue(r.path,$t.remap(n,0,16383,r.min,r.max)),this.output_handler&&this.output_handler(r.path,this.getParamValue(r.path))}}midiMessage(e){var n=e[0]>>4,s=e[0]&15,r=e[1],o=e[2];s!==9&&(n===11?this.ctrlChange(s,r,o):n===14&&this.pitchWheel(s,o*128+r))}onMidi(e){this.midiMessage(e)}async getState(){var e=new Object;for(let n=0;n<this.getParams().length;n++)Object.assign(e,{[this.getParams()[n]]:`${this.getParam(this.getParams()[n])}`});return new Promise(n=>{n(e)})}async setState(e){return new Promise(n=>{for(const s in e)e.hasOwnProperty(s)&&this.setParam(s,e[s]);try{this.gui.setAttribute("state",JSON.stringify(e))}catch(s){console.warn("Plugin without gui or GUI not defined",s)}n(e)})}setPatch(e){this.setState(this.presets[e])}static remap(e,n,s,r,o){return 1*(e-n)/(s-n)*(o-r)+r}}let Ha=`

    'use strict';

    // Monophonic Faust DSP
    class Processor extends AudioWorkletProcessor {
        
        // JSON parsing functions
        static parse_ui(ui, obj, callback)
        {
            for (var i = 0; i < ui.length; i++) {
                Processor.parse_group(ui[i], obj, callback);
            }
        }
        
        static parse_group(group, obj, callback)
        {
            if (group.items) {
                Processor.parse_items(group.items, obj, callback);
            }
        }
        
        static parse_items(items, obj, callback)
        {
            for (var i = 0; i < items.length; i++) {
                callback(items[i], obj, callback);
            }
        }
        
        static parse_item1(item, obj, callback)
        {
            if (item.type === "vgroup"
                || item.type === "hgroup"
                || item.type === "tgroup") {
                Processor.parse_items(item.items, obj, callback);
            } else if (item.type === "hbargraph"
                       || item.type === "vbargraph") {
                // Nothing
            } else if (item.type === "vslider"
                       || item.type === "hslider"
                       || item.type === "button"
                       || item.type === "checkbox"
                       || item.type === "nentry") {
                obj.push({ name: item.address,
                         defaultValue: item.init,
                         minValue: item.min,
                         maxValue: item.max });
            }
        }
        
        static parse_item2(item, obj, callback)
        {
            if (item.type === "vgroup"
                || item.type === "hgroup"
                || item.type === "tgroup") {
                Processor.parse_items(item.items, obj, callback);
            } else if (item.type === "hbargraph"
                       || item.type === "vbargraph") {
                // Keep bargraph adresses
                obj.outputs_items.push(item.address);
                obj.pathTable[item.address] = parseInt(item.index);
            } else if (item.type === "vslider"
                       || item.type === "hslider"
                       || item.type === "button"
                       || item.type === "checkbox"
                       || item.type === "nentry") {
                // Keep inputs adresses
                obj.inputs_items.push(item.address);
                obj.pathTable[item.address] = parseInt(item.index);
            }
        }
     
        static get parameterDescriptors() 
        {
            // Analyse JSON to generate AudioParam parameters
            var params = [];
            Processor.parse_ui(JSON.parse(\`JSON_STR\`).ui, params, Processor.parse_item1);
            return params;
        }
       
        constructor(options)
        {

            super(options);

            this.running = true;
            
            const importObject = {
                    env: {
                        memoryBase: 0,
                        tableBase: 0,

                        // Integer version
                        _abs: Math.abs,

                        // Float version
                        _acosf: Math.acos,
                        _asinf: Math.asin,
                        _atanf: Math.atan,
                        _atan2f: Math.atan2,
                        _ceilf: Math.ceil,
                        _cosf: Math.cos,
                        _expf: Math.exp,
                        _floorf: Math.floor,
                        _fmodf: function(x, y) { return x % y; },
                        _logf: Math.log,
                        _log10f: Math.log10,
                        _max_f: Math.max,
                        _min_f: Math.min,
                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },
                        _powf: Math.pow,
                        _roundf: Math.fround,
                        _sinf: Math.sin,
                        _sqrtf: Math.sqrt,
                        _tanf: Math.tan,
                        _acoshf: Math.acosh,
                        _asinhf: Math.asinh,
                        _atanhf: Math.atanh,
                        _coshf: Math.cosh,
                        _sinhf: Math.sinh,
                        _tanhf: Math.tanh,

                        // Double version
                        _acos: Math.acos,
                        _asin: Math.asin,
                        _atan: Math.atan,
                        _atan2: Math.atan2,
                        _ceil: Math.ceil,
                        _cos: Math.cos,
                        _exp: Math.exp,
                        _floor: Math.floor,
                        _fmod: function(x, y) { return x % y; },
                        _log: Math.log,
                        _log10: Math.log10,
                        _max_: Math.max,
                        _min_: Math.min,
                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },
                        _pow: Math.pow,
                        _round: Math.fround,
                        _sin: Math.sin,
                        _sqrt: Math.sqrt,
                        _tan: Math.tan,
                        _acosh: Math.acosh,
                        _asinh: Math.asinh,
                        _atanh: Math.atanh,
                        _cosh: Math.cosh,
                        _sinh: Math.sinh,
                        _tanh: Math.tanh,

                        table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })
                    }
            };
            
            const wasmModule = new WebAssembly.Module(options.processorOptions.wasm_buffer);
            this.processor_instance = new WebAssembly.Instance(wasmModule, importObject);
            this.json_object = JSON.parse(options.processorOptions.json);
         
            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };
            
            this.ins = null;
            this.outs = null;

            this.dspInChannnels = [];
            this.dspOutChannnels = [];

            this.numIn = parseInt(this.json_object.inputs);
            this.numOut = parseInt(this.json_object.outputs);

            // Memory allocator
            this.ptr_size = 4;
            this.sample_size = 4;
            this.integer_size = 4;
            
            this.factory = this.processor_instance.exports;
            this.HEAP = this.processor_instance.exports.memory.buffer;
            this.HEAP32 = new Int32Array(this.HEAP);
            this.HEAPF32 = new Float32Array(this.HEAP);

            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC
            //console.log(this.HEAP);
            //console.log(this.HEAP32);
            //console.log(this.HEAPF32);

            // bargraph
            this.outputs_timer = 5;
            this.outputs_items = [];

            // input items
            this.inputs_items = [];
        
            // Start of HEAP index

            // DSP is placed first with index 0. Audio buffer start at the end of DSP.
            this.audio_heap_ptr = parseInt(this.json_object.size);

            // Setup pointers offset
            this.audio_heap_ptr_inputs = this.audio_heap_ptr;
            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);

            // Setup buffer offset
            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);
            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);
            
            // Start of DSP memory : DSP is placed first with index 0
            this.dsp = 0;

            this.pathTable = [];
         
            // Send output values to the AudioNode
            this.update_outputs = function ()
            {
                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {
                    this.outputs_timer = 5;
                    for (var i = 0; i < this.outputs_items.length; i++) {
                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);
                    }
                }
            }
            
            this.initAux = function ()
            {
                var i;
                
                if (this.numIn > 0) {
                    this.ins = this.audio_heap_ptr_inputs;
                    for (i = 0; i < this.numIn; i++) {
                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);
                    }
                    
                    // Prepare Ins buffer tables
                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);
                    for (i = 0; i < this.numIn; i++) {
                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);
                    }
                }
                
                if (this.numOut > 0) {
                    this.outs = this.audio_heap_ptr_outputs;
                    for (i = 0; i < this.numOut; i++) {
                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);
                    }
                    
                    // Prepare Out buffer tables
                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);
                    for (i = 0; i < this.numOut; i++) {
                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);
                    }
                }
                
                // Parse UI
                Processor.parse_ui(this.json_object.ui, this, Processor.parse_item2);
                
                // Init DSP
                this.factory.init(this.dsp, sampleRate); // 'sampleRate' is defined in AudioWorkletGlobalScope  
            }

            this.setParamValue = function (path, val)
            {
                this.HEAPF32[this.pathTable[path] >> 2] = val;
            }

            this.getParamValue = function (path)
            {
                return this.HEAPF32[this.pathTable[path] >> 2];
            }

            // Init resulting DSP
            this.initAux();

        }
        
        process(inputs, outputs, parameters) 
        {
            var input = inputs[0];
            var output = outputs[0];
            
            // Check inputs
            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {
                console.error("Process input error");
                return true;
            }
            // Check outputs
            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {
                console.error("Process output error");
                return true;
            }
            
            // Copy inputs
            if (input !== undefined) {
                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {
                    var dspInput = this.dspInChannnels[chan];
                    dspInput.set(input[chan]);
                }
            }
            
            /*
            TODO: sample accurate control change is not yet handled
            When no automation occurs, params[i][1] has a length of 1,
            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample
            */
            
            // Update controls
            for (const path in parameters) {
                const paramArray = parameters[path];
                this.setParamValue(path, paramArray[0]);
            }
        
          	// Compute
            try {
                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);
            } catch(e) {
                console.log("ERROR in compute (" + e + ")");
            }
            
            // Update bargraph
            this.update_outputs();
            
            // Copy outputs
            if (output !== undefined) {
                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {
                    var dspOutput = this.dspOutChannnels[chan];
                    output[chan].set(dspOutput);
                }
            }
            
            return this.running;
    	}
        
        handleMessage(event)
        {
            var msg = event.data;
            switch (msg.type) {
                case "destroy": this.running = false; break;
            }
        }
    }

    // Globals
    const NUM_FRAMES = 128;
    try {
        registerProcessor('processor', Processor);
    } catch (error) {
        console.error("Can't register processor,", error);
    }
`;function Ua(t){let e="",n=0;for(;t[n]!==0;)e+=String.fromCharCode(t[n++]);return e}async function za(t,e){let n=[];try{const s={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:(d,h)=>d%h,_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:(d,h)=>d-Math.round(d/h)*h,_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(d){return!isFinite(d)},_copysignf:function(d,h){return Math.sign(d)===Math.sign(h)?d:-d},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:(d,h)=>d%h,_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:(d,h)=>d-Math.round(d/h)*h,_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(d){return!isFinite(d)},_copysign:function(d,h){return Math.sign(d)===Math.sign(h)?d:-d},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},o=await(await fetch(e)).arrayBuffer(),i=await WebAssembly.compile(o),a=await WebAssembly.instantiate(i,s);let c=new Uint8Array(a.exports.memory.buffer),l=Ua(c),u=JSON.parse(l),p={json:l,wasm_buffer:o};if(n.indexOf(e)===-1)try{let d=/JSON_STR/g,h=Ha.replace(d,l),m=window.URL.createObjectURL(new Blob([h],{type:"text/javascript"}));await t.audioWorklet.addModule(m),console.log("Keep the DSP url"),n.push(e)}catch(d){return console.error("Faust "+e+" cannot be loaded or compiled,",d),null}let f=new $t(t,e,{numberOfInputs:parseInt(u.inputs)>0?1:0,numberOfOutputs:parseInt(u.outputs)>0?1:0,channelCount:Math.max(1,parseInt(u.inputs)),outputChannelCount:[parseInt(u.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:p});return f.onprocessorerror=d=>{console.error("An error from processor was detected,",d)},f}catch(s){return console.error("Faust "+e+" cannot be loaded or compiled,",s),null}}const Rn=(t,e,n,s,r,o,i)=>{const{x:a,y:c,w:l,h:u}=dt(e);return Ba(t,n,a,c,r?u:l,u,r?u:0,s,o,i)},Ba=(t,e,n,s,r,o,i,a,c,l)=>{const u=t.theme,p=tt([n,s,r,o]);t.registerID(e,p);let f;const d=t.resource(e,p,()=>ot([n,s],[r,o])),h=Cs(t,e,d,l),m=t.requestFocus(e);let b=!t.buttons&&t.hotID===e&&t.activeID===e;return m&&(b=Rs(t)||b),b&&(f=a=!a),t.draw&&(d.attribs={fill:a?t.fgColor(h):t.bgColor(h),stroke:t.focusColor(e)},t.add(d),c&&t.add(pt([n+u.pad+i,s+o/2+u.baseLine],t.textColor(h&&i>0&&i<r-u.pad),c))),t.lastID=e,f},xa=3737844653;class We extends Va{constructor(e=xa){super(),this.buffer=new Uint32Array([e,0])}copy(){const e=new We;return e.buffer.set(this.buffer),e}seed(e){return this.buffer.set([e,0]),this}int(){const e=this.buffer,n=1540483477,s=e[1]++*n>>>0,r=e[0]=(s^s>>24^e[0]*n>>>0)*n>>>0;return(r^r>>>13)>>>0}}const Nn=new We(3737844653),Ga=t=>{if(t.state!=="suspended")return;const e=document.body,n=["touchstart","touchend","mousedown","keydown"],s=()=>t.resume().then(r),r=()=>n.forEach(o=>e.removeEventListener(o,s));n.forEach(o=>e.addEventListener(o,s,!1))},qt=new AudioContext;Ga(qt);const M=await za(qt,"./melody.wasm"),lt=qt.createAnalyser(),wt=new Uint8Array(lt.fftSize),pe=lt.frequencyBinCount,$n=new Float32Array(pe);M&&(M.setOutputParamHandler((t,e)=>{console.log(t,e)}),M.connect(qt.destination),M.connect(lt));const Ln=[Is,{globalBg:"#ccc",focus:[1,.66,0,1],cursor:[0,0,0,1],bg:[1,1,1,.66],bgDisabled:[1,1,1,.33],bgHover:[1,1,1,.9],fg:[.8,0,.8,1],fgDisabled:[.8,0,.8,.5],fgHover:[1,0,1,1],text:[.3,.3,.3,1],textDisabled:[.3,.3,.3,.5],textHover:[.2,.2,.4,1],bgTooltip:[1,1,.8,.85],textTooltip:[0,0,0,1]}],Wa=ye(0),qa=ye(2),Xa=`${320*30/600}px 'IBM Plex Mono'`,Ja=["KICK","HATS","CHRD","MRMB","DJMB"],Za=["kick/volume","hat/volume","chords/volume","marimba/volume","djembe/volume"],Ya=["i-iv-VI-v","i-iv-III-VI","i-VI-III-VII","i-VI-III-iv","I-vi-IV-V","I-V-vi-IV","I-IV-V-IV","vi-IV-I-V","I-IV-ii-V","I-IV-I-V"],Ka=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],T=new oe({theme:0,channels:[.5,.5,.5,.5,.5],bpm:118,progression:0,key:0,kickSteps:new Array(16).fill(!1),hatSteps:new Array(16).fill(!1)}),Fn=t=>({...Ln[t%Ln.length],font:Xa,cursorBlink:0}),Qa=()=>{const t=new Bi({theme:Fn(T.deref().theme)}),e={...Uo,init(a){ra(a,{}).subscribe({next(c){t.setMouse(c.pos,c.buttons)}}),de(window,"keydown").subscribe({next(c){c.key===I.TAB&&c.preventDefault(),t.setKey(c)}}),de(window,"keyup").subscribe({next(c){t.setKey(c)}})}},n=Pn({update(a,c,l,u,p,f){const d=f.width,h=f.height;re(a,d,h),lt.getByteTimeDomainData(wt);const m=a.width/wt.length*(Ke()?2:1);c.clearRect(0,0,a.width,a.width),c.beginPath();for(let b=0;b<wt.length;b+=4){const _=wt[b]/256*(Ke()?2:1),y=0+b*m,g=0+h*_;c.lineTo(y,g)}c.stroke()}}),s=Pn({update(a,c,l,u,p,f){const b=c.getImageData(0,0,a.width,a.height);re(a,f.width,f.height),c.putImageData(b,0,0),lt.getFloatFrequencyData($n);const _=a.height/pe;for(let y=0;y<pe;y++){const g=Math.pow(1.8,$n[y]/25),w=120+y/3;c.fillStyle=`hsl(${360*-g+w}deg, 100%, ${g*100}%)`,c.fillRect(a.width-1,-y*_+a.height,1,_)}c.save(),c.translate(-1,0),c.drawImage(a,0,0),c.restore()}}),r=a=>`/melody/${a}`,o=T.deref();o.kickSteps.forEach((a,c)=>{const l=Nn.float()>.5;M?.setParamValue(r(`kickStep${c}`),l?1:0),T.resetIn(["kickSteps",c],l)}),o.hatSteps.forEach((a,c)=>{const l=Nn.float()>.5;M?.setParamValue(r(`hatStep${c}`),l?1:0),T.resetIn(["hatSteps",c],l)});const i=(a,c)=>{const u=T.deref(),p=c/40,f=Fs(10,10,a-20,1,p,4),d=c/40;t.setTheme({...Fn(u.theme),font:`${d}px 'IBM Plex Mono'`}),t.begin(!0);let h;const m=f.nest(1,[1,5]);ee(t,m,"PROGRESSION"),(h=En(t,m,"progression",u.progression,Ya,""))!==void 0&&(M?.setParamValue(r("progression"),h),M?.setParamValue(r("scale"),h>3?1:0),T.resetIn(["progression"],h)),ee(t,m,"KEY"),(h=En(t,m,"key",u.key,Ka,""))!==void 0&&(M?.setParamValue(r("key"),h),T.resetIn(["key"],h));const b=f.nest(5,[1,8]);Za.forEach((w,S)=>{const E=b.nest(1);(h=Ui(t,E,w,0,1,.01,u.channels[S],8,"",qa))!==void 0&&(M?.setParamValue(r(w),h),T.resetIn(["channels",S],h)),ee(t,E,Ja[S])});const _=f.nest(5,[2,3]);(h=Vi(t,_,"bpm",30,180,1,u.bpm,Ft,.5,"BPM",Wa))!==void 0&&(M?.setParamValue(r("bpm"),h),T.resetIn(["bpm"],h)),Di(t,_,"resync",3,"SYNC")&&(M?.setParamValue(r("reset"),1),M?.setParamValue(r("reset"),0));const y=f.nest(16);u.kickSteps.forEach((w,S)=>{(h=Rn(t,y,`kickStep${S}`,u.kickSteps[S],!1,""))!==void 0&&(M?.setParamValue(r(`kickStep${S}`),h?1:0),T.resetIn(["kickSteps",S],h))});const g=f.nest(16);u.hatSteps.forEach((w,S)=>{(h=Rn(t,g,`hatStep${S}`,u.hatSteps[S],!1,""))!==void 0&&(M?.setParamValue(r(`hatStep${S}`),h?1:0),T.resetIn(["hatSteps",S],h))}),t.end()};return()=>{const a=window.innerWidth,c=window.innerHeight;return i(a,c/3*2),["div",[n,{width:a,height:c/3/2}],["br"],[s,{width:a,height:c/3/2}],,[e,{width:a,height:c/3*2,style:{background:t.theme.globalBg,cursor:t.cursor},oncontextmenu:l=>l.preventDefault(),...t.attribs},t]]}};ca().transform(x(Qa()),Fa());
